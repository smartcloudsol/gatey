"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[788],{74788:(e,s,t)=>{t.r(s),t.d(s,{default:()=>M});var i=t(94285),l=t(64999),n=t(5055),a=t(82287),r=t(48324),o=t(17826),d=t(69019),c=t(89652),m=t(31179),u=t(49674),f=t(57193),x=t(77828),p=t(40054),h=t(4039),g=t(69329),j=t(9543),y=t(45727),v=t(6447),b=t(80323),F=t(34164),I=t(27723),$=t(70544),k=t(57693),C=t(7641),A=t(20899),w=t(22342),z=t(48285),E=t(29287),S=t(42449),_=t(4225),D=t(30988),V=t(51609),T=t(69439),L=t(43226),N=t(10790);const Y=["text","checkbox","radio","password","tel","country","select"],P={id:T.Yj(),name:T.Yj().min(1,"Name is required"),type:T.k5(Y),values:T.YO(T.Ik({value:T.Yj().transform((e=>e.trim())),label:T.Yj().transform((e=>e.trim()))})).optional()},O=T.Ik({formFields:T.YO(T.Ik(P))}),B={formFields:[]};function M({amplifyConfigured:e,config:s,accountId:t,siteId:d,siteKey:c,onSave:m,InfoLabelComponent:u}){const[f,x]=(0,V.useState)(!1),[p,h]=(0,V.useState)(!1),v=(0,g.m)({mode:"uncontrolled",initialValues:{...B},validate:(0,D.u)(O)}),b=(0,V.useCallback)((async e=>{if(t&&d&&c){h(!0);try{const l=[];e.formFields.forEach((e=>{"string"!=typeof e&&e.name&&(l.push({name:"custom:"+e.name,type:e.type||"text"}),void 0!==e.values&&(l[l.length-1].values=e.values))}));const n={...s,formFields:l};delete n.secondaryDomain,delete n.subscriptionType;const a=await async function(e,s,t,l){const n=(0,i.yJ)({apiName:"backend",path:`/account/${e}/site/${s}/settings`,options:{body:{settings:l},headers:{"X-Site-Key":t}}}),a=await n.response;if(a.statusCode<200||a.statusCode>=300)throw new Error(a.body.toString());return(await a.body.json()).settings}(t,d,c,n);m(a),j.$e.show({title:(0,I.__)("Settings saved",$.TEXT_DOMAIN),message:(0,I.__)("Form field settings saved successfully",$.TEXT_DOMAIN),color:"green",icon:(0,N.jsx)(k.A,{}),className:L.A.notification})}catch(e){console.error("Error saving form field settings:",e),j.$e.show({title:(0,I.__)("Error occured",$.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,N.jsx)(C.A,{}),className:L.A.notification})}finally{h(!1)}}else console.error("Missing account ID or site ID or site key")}),[t,d,c,s,m]);return(0,V.useEffect)((()=>{if(!f&&s){const e={formFields:[]};if(s.formFields){const t=[];s.formFields.forEach((e=>{const s=v.getValues().formFields||[],i=e.name.replace(/^custom:/,""),l=s.find((e=>e.name===i));t.push({id:l?.id||(0,y.z)(),name:i,type:e.type||"text",values:e.values?e.values.filter((e=>e.value&&e.label)).map((e=>({value:e.value,label:e.label}))):void 0})})),e.formFields=t}v.setValues(e),x(!0)}}),[s,v,f]),(0,V.useEffect)((()=>{s&&x(!1)}),[s]),(0,N.jsxs)("form",{onSubmit:v.onSubmit(b),children:[0===v.getValues().formFields.length?(0,N.jsx)(R,{form:v,formValuesSet:f}):(0,N.jsx)(X,{form:v,formValuesSet:f,InfoLabelComponent:u}),(0,N.jsxs)(l.Y,{justify:"flex-end",mt:"xl",children:[(0,N.jsx)(n.$,{type:"submit",variant:"gradient",loading:p,leftSection:(0,N.jsx)(A.A,{size:16}),disabled:!e,children:"Save Custom Field Configuration"}),!e&&(0,N.jsxs)(a.j,{children:[(0,N.jsx)(a.j.Target,{children:(0,N.jsx)(r.M,{variant:"subtle",size:"xs",children:(0,N.jsx)(w.A,{size:16,color:"red"})})}),(0,N.jsx)(a.j.Dropdown,{maw:300,style:{zIndex:1e4},children:(0,N.jsxs)(o.E,{size:"sm",children:[(0,N.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]})}function R({form:e}){const s=e.getValues().formFields,[,t]=(0,v.p)(s||[]);return(0,N.jsxs)(d.B,{align:"center",gap:"md",py:"xl",mb:"lg",bg:"gray.1",style:{borderRadius:"5px"},children:[(0,N.jsx)(c.h,{order:5,children:"No Form Fields Configured"}),(0,N.jsx)(o.E,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any form fields yet."}),(0,N.jsx)(n.$,{variant:"gradient",size:"xs",leftSection:(0,N.jsx)(z.A,{}),onClick:()=>{const s={id:(0,y.z)(),name:"",type:"text"};t.append(s),e.insertListItem("formFields",s)},children:"Add Form Field"})]})}function X({form:e,formValuesSet:s,InfoLabelComponent:t}){const[i,a]=(0,V.useState)(!0),[r,o]=(0,V.useState)(!1),c=e.getValues().formFields,[m,u]=(0,v.p)(c||[]),f=(0,V.useCallback)((()=>{const s={id:(0,y.z)(),name:"",type:"text"};u.append(s),e.insertListItem("formFields",s)}),[e,u]);return(0,V.useEffect)((()=>{r&&(o(!1),m.forEach(((s,t)=>{const i=c.findIndex((e=>e.id===s.id));-1!==i?e.setFieldValue(`formFields.${i}.order`,t+1):console.warn(`Field with id ${s.id} not found in original fields array`)})))}),[c,m,r,e,s]),(0,V.useEffect)((()=>{s&&a(!1)}),[s]),(0,V.useEffect)((()=>{i||(a(!0),u.setState(e.getValues().formFields.map((e=>({...e})))))}),[e,i,s,u]),(0,N.jsxs)(d.B,{gap:"md",mb:"lg",children:[(0,N.jsx)(b.JY,{onDragEnd:({destination:e,source:s})=>{u.reorder({from:s.index,to:e?.index||0}),o(!0)},children:(0,N.jsx)(b.gL,{droppableId:"dnd-list",direction:"vertical",isDropDisabled:!0,children:s=>(0,N.jsxs)("div",{...s.droppableProps,ref:s.innerRef,children:[m.map(((s,i)=>(0,N.jsx)(b.sx,{index:i,draggableId:s.id,isDragDisabled:!0,children:(i,l)=>(0,N.jsxs)("div",{className:(0,F.A)(L.A.item,{[L.A.itemDragging]:l.isDragging}),ref:i.innerRef,...i.draggableProps,children:[(0,N.jsx)("div",{...i.dragHandleProps,className:L.A.dragHandle,children:(0,N.jsx)(E.A,{size:18,stroke:1.5})}),(0,N.jsx)(H,{form:e,state:m,setReorder:o,handlers:u,index:c.findIndex((e=>e.id===s.id)),InfoLabelComponent:t},s.id)]})},s.id))),s.placeholder]})})}),(0,N.jsx)(l.Y,{justify:"center",children:(0,N.jsx)(n.$,{variant:"subtle",size:"compact-xs",leftSection:(0,N.jsx)(S.A,{size:14}),w:"100%",mt:"0.3rem",onClick:f,children:"Add Form Field"})})]})}function H({form:e,state:s,handlers:t,setReorder:i,index:l,InfoLabelComponent:a}){const c=`formFields.${l}`,g=e.getValues().formFields[l];return g&&("radio"===g.type||"select"===g.type?g.values&&Array.isArray(g.values)||(g.values=[]):g.values=void 0),(0,N.jsx)(m.Z,{shadow:"sm",w:"100%",withBorder:!0,children:(0,N.jsx)(d.B,{children:(0,N.jsxs)(u.x,{children:[(0,N.jsx)(u.x.Col,{span:6,style:{display:"flex",alignItems:"center"},children:(0,N.jsx)(f.k,{label:(0,N.jsx)(a,{text:"Name",scrollToId:"field-name"}),placeholder:"Enter custom field name",...e.getInputProps(`${c}.name`),onBlur:()=>i(!0),style:{width:"100%"}},e.key(`${c}.name`))}),(0,N.jsx)(u.x.Col,{span:6,children:(0,N.jsx)(x.l,{label:(0,N.jsx)(a,{text:"Type",scrollToId:"field-type"}),defaultValue:"text",data:Y,...e.getInputProps(`${c}.type`),onChange:s=>{e.setFieldValue(`${c}.type`,s||"text"),i(!0)}},e.key(`${c}.type`))}),("radio"===g?.type||"select"===g?.type)&&(0,N.jsxs)(m.Z,{withBorder:!0,m:"xs",p:"xs",w:"100%",h:"100%",children:[(0,N.jsxs)(m.Z.Section,{p:"md",children:[(0,N.jsx)(o.E,{size:"sm",fw:500,component:"div",children:(0,N.jsx)(a,{text:"Options",scrollToId:"field-options"})}),(0,N.jsx)(o.E,{c:"dimmed",size:"xs",children:"Add options for radio or select fields. Each option must have a label and a value."})]}),g.values?.map(((s,t)=>(0,N.jsxs)(p.s,{direction:"row",gap:"xs",align:"center",children:[(0,N.jsx)(f.k,{label:"Value",...e.getInputProps(`${c}.values.${t}.value`)},e.key(`${c}.values.${t}.value`)),(0,N.jsx)(f.k,{label:"Label",...e.getInputProps(`${c}.values.${t}.label`)},e.key(`${c}.values.${t}.label`)),(0,N.jsx)(n.$,{variant:"subtle",size:"xs",mt:"0.3rem",onClick:()=>e.removeListItem(`${c}.values`,t),children:(0,N.jsx)(_.A,{size:14,color:"red"})})]},e.key(`${c}.values.${t}`)))),(0,N.jsx)(n.$,{variant:"subtle",mt:"xs",size:"xs",leftSection:(0,N.jsx)(S.A,{size:14}),onClick:()=>{e.insertListItem(`${c}.values`,{id:(0,y.z)(),value:"",label:""})},children:"Add Option"})]}),(0,N.jsx)(u.x.Col,{span:6,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,N.jsx)(h.m,{label:"Delete Form Field",children:(0,N.jsx)(r.M,{color:"red",variant:"subtle","aria-label":"Delete Form Field",onClick:()=>{const n=e.getValues().formFields[l];e.removeListItem("formFields",l),t.remove(s.findIndex((e=>e.id===n.id))),i(!0)},children:(0,N.jsx)(_.A,{size:"1rem"})})})})]})})})}}}]);