"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[788],{74788(e,s,i){i.r(s),i.d(s,{default:()=>M});var t=i(6252),l=i(48324),n=i(64999),a=i(40054),r=i(5055),o=i(31179),d=i(49674),c=i(14598),m=i(77828),u=i(69019),f=i(17826),x=i(57193),p=i(89652),g=i(4039),h=i(69329),j=i(9543),y=i(45727),v=i(6447),b=i(45382),F=i(34164),I=i(27723),$=i(70544),k=i(7641),C=i(20899),A=i(29287),w=i(57693),z=i(22342),E=i(42449),S=i(48285),_=i(4225),V=i(30988),D=i(51609),T=i(8354),L=i(43226),P=i(10790);const N=["text","checkbox","radio","password","tel","country","select"],Y={id:T.YjP(),name:T.YjP().min(1,"Name is required"),type:T.k5n(N),values:T.YOg(T.Ikc({value:T.YjP().transform(e=>e.trim()),label:T.YjP().transform(e=>e.trim())})).optional()},O=T.Ikc({formFields:T.YOg(T.Ikc(Y))}),B={formFields:[]};function M({amplifyConfigured:e,config:s,accountId:i,siteId:a,siteKey:o,onSave:d,InfoLabelComponent:m}){const[u,x]=(0,D.useState)(!1),[p,g]=(0,D.useState)(!1),v=(0,h.m)({mode:"uncontrolled",initialValues:{...B},validate:(0,V.s)(O)}),b=(0,D.useCallback)(async e=>{if(i&&a&&o){g(!0);try{const l=[];e.formFields.forEach(e=>{"string"!=typeof e&&e.name&&(l.push({name:"custom:"+e.name,type:e.type||"text"}),void 0!==e.values&&(l[l.length-1].values=e.values))});const n={...s,formFields:l};delete n.subscriptionType;const r=await async function(e,s,i,l){const n=(0,t.yJ)({apiName:"backend",path:`/account/${e}/site/${s}/settings`,options:{body:{settings:l},headers:{"X-Site-Key":i}}}),a=await n.response;if(a.statusCode<200||a.statusCode>=300)throw new Error(a.body.toString());return(await a.body.json()).settings}(i,a,o,n);d(r),j.$e.show({title:(0,I.__)("Settings saved",$.TEXT_DOMAIN),message:(0,I.__)("Form field settings saved successfully",$.TEXT_DOMAIN),color:"green",icon:(0,P.jsx)(w.A,{}),className:L.A.notification})}catch(e){console.error("Error saving form field settings:",e),j.$e.show({title:(0,I.__)("Error occured",$.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,P.jsx)(k.A,{}),className:L.A.notification})}finally{g(!1)}}else console.error("Missing account ID or site ID or site key")},[i,a,o,s,d]);return(0,D.useEffect)(()=>{if(!u&&s){const e={formFields:[]};if(s.formFields){const i=[];s.formFields.forEach(e=>{const s=v.getValues().formFields||[],t=e.name.replace(/^custom:/,""),l=s.find(e=>e.name===t);i.push({id:l?.id||(0,y.z)(),name:t,type:e.type||"text",values:e.values?e.values.filter(e=>e.value&&e.label).map(e=>({value:e.value,label:e.label})):void 0})}),e.formFields=i}v.setValues(e),x(!0)}},[s,v,u]),(0,D.useEffect)(()=>{s&&x(!1)},[s]),(0,P.jsxs)("form",{onSubmit:v.onSubmit(b),children:[0===v.getValues().formFields.length?(0,P.jsx)(X,{form:v,formValuesSet:u}):(0,P.jsx)(H,{form:v,formValuesSet:u,InfoLabelComponent:m}),(0,P.jsxs)(n.Y,{justify:"flex-end",mt:"xl",children:[(0,P.jsx)(r.$,{type:"submit",variant:"gradient",loading:p,leftSection:(0,P.jsx)(C.A,{size:16}),disabled:!e,children:"Save Custom Field Configuration"}),!e&&(0,P.jsxs)(c.j,{children:[(0,P.jsx)(c.j.Target,{children:(0,P.jsx)(l.M,{variant:"subtle",size:"xs",children:(0,P.jsx)(z.A,{size:16,color:"red"})})}),(0,P.jsx)(c.j.Dropdown,{maw:300,style:{zIndex:1e4},children:(0,P.jsxs)(f.E,{size:"sm",children:[(0,P.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]})}function X({form:e}){const s=e.getValues().formFields,[,i]=(0,v.p)(s||[]);return(0,P.jsxs)(u.B,{align:"center",gap:"md",py:"xl",mb:"lg",bg:"gray.1",style:{borderRadius:"5px"},children:[(0,P.jsx)(p.h,{order:5,children:"No Form Fields Configured"}),(0,P.jsx)(f.E,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any form fields yet."}),(0,P.jsx)(r.$,{variant:"gradient",size:"xs",leftSection:(0,P.jsx)(S.A,{}),onClick:()=>{const s={id:(0,y.z)(),name:"",type:"text"};i.append(s),e.insertListItem("formFields",s)},children:"Add Form Field"})]})}function H({form:e,formValuesSet:s,InfoLabelComponent:i}){const t=e.getValues().formFields,[l,a]=(0,v.p)(t||[]),o=(0,D.useCallback)(()=>{const s={id:(0,y.z)(),name:"",type:"text"};a.append(s),e.insertListItem("formFields",s)},[e,a]),d=(0,D.useCallback)(()=>{l.forEach((s,i)=>{const l=t.findIndex(e=>e.id===s.id);-1!==l?e.setFieldValue(`formFields.${l}.order`,i+1):console.warn(`Field with id ${s.id} not found in original fields array`)})},[t,e,l]);return(0,D.useEffect)(()=>{s&&a.setState(e.getValues().formFields.map(e=>({...e})))},[e,s,a]),(0,P.jsxs)(u.B,{gap:"md",mb:"lg",children:[(0,P.jsx)(b.JY,{onDragEnd:({destination:e,source:s})=>{a.reorder({from:s.index,to:e?.index||0}),d()},children:(0,P.jsx)(b.gL,{droppableId:"dnd-list",direction:"vertical",isDropDisabled:!0,children:s=>(0,P.jsxs)("div",{...s.droppableProps,ref:s.innerRef,children:[l.map((s,n)=>(0,P.jsx)(b.sx,{index:n,draggableId:s.id,isDragDisabled:!0,children:(n,r)=>(0,P.jsxs)("div",{className:(0,F.A)(L.A.item,{[L.A.itemDragging]:r.isDragging}),ref:n.innerRef,...n.draggableProps,children:[(0,P.jsx)("div",{...n.dragHandleProps,className:L.A.dragHandle,children:(0,P.jsx)(A.A,{size:18,stroke:1.5})}),(0,P.jsx)(R,{form:e,state:l,reorder:d,handlers:a,index:t.findIndex(e=>e.id===s.id),InfoLabelComponent:i},s.id)]})},s.id)),s.placeholder]})})}),(0,P.jsx)(n.Y,{justify:"center",children:(0,P.jsx)(r.$,{variant:"subtle",size:"compact-xs",leftSection:(0,P.jsx)(E.A,{size:14}),w:"100%",mt:"0.3rem",onClick:o,children:"Add Form Field"})})]})}function R({form:e,state:s,handlers:i,reorder:t,index:n,InfoLabelComponent:c}){const p=`formFields.${n}`,h=e.getValues().formFields[n];return h&&("radio"===h.type||"select"===h.type?h.values&&Array.isArray(h.values)||(h.values=[]):h.values=void 0),(0,P.jsx)(o.Z,{shadow:"sm",w:"100%",withBorder:!0,children:(0,P.jsx)(u.B,{children:(0,P.jsxs)(d.x,{children:[(0,P.jsx)(d.x.Col,{span:6,style:{display:"flex",alignItems:"center"},children:(0,P.jsx)(x.k,{label:(0,P.jsx)(c,{text:"Name",scrollToId:"field-name"}),placeholder:"Enter custom field name",...e.getInputProps(`${p}.name`),onBlur:()=>t(),style:{width:"100%"}},e.key(`${p}.name`))}),(0,P.jsx)(d.x.Col,{span:6,children:(0,P.jsx)(m.l,{label:(0,P.jsx)(c,{text:"Type",scrollToId:"field-type"}),defaultValue:"text",data:N,...e.getInputProps(`${p}.type`),onChange:s=>{e.setFieldValue(`${p}.type`,s||"text"),t()}},e.key(`${p}.type`))}),("radio"===h?.type||"select"===h?.type)&&(0,P.jsxs)(o.Z,{withBorder:!0,m:"xs",p:"xs",w:"100%",h:"100%",children:[(0,P.jsxs)(o.Z.Section,{p:"md",children:[(0,P.jsx)(f.E,{size:"sm",fw:500,component:"div",children:(0,P.jsx)(c,{text:"Options",scrollToId:"field-options"})}),(0,P.jsx)(f.E,{c:"dimmed",size:"xs",children:"Add options for radio or select fields. Each option must have a label and a value."})]}),h.values?.map((s,i)=>(0,P.jsxs)(a.s,{direction:"row",gap:"xs",align:"center",children:[(0,P.jsx)(x.k,{label:"Value",...e.getInputProps(`${p}.values.${i}.value`)},e.key(`${p}.values.${i}.value`)),(0,P.jsx)(x.k,{label:"Label",...e.getInputProps(`${p}.values.${i}.label`)},e.key(`${p}.values.${i}.label`)),(0,P.jsx)(r.$,{variant:"subtle",size:"xs",mt:"0.3rem",onClick:()=>e.removeListItem(`${p}.values`,i),children:(0,P.jsx)(_.A,{size:14,color:"red"})})]},e.key(`${p}.values.${i}`))),(0,P.jsx)(r.$,{variant:"subtle",mt:"xs",size:"xs",leftSection:(0,P.jsx)(E.A,{size:14}),onClick:()=>{e.insertListItem(`${p}.values`,{id:(0,y.z)(),value:"",label:""})},children:"Add Option"})]}),(0,P.jsx)(d.x.Col,{span:6,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,P.jsx)(g.m,{label:"Delete Form Field",children:(0,P.jsx)(l.M,{color:"red",variant:"subtle","aria-label":"Delete Form Field",onClick:()=>{const l=e.getValues().formFields[n];e.removeListItem("formFields",n),i.remove(s.findIndex(e=>e.id===l.id)),t()},children:(0,P.jsx)(_.A,{size:"1rem"})})})})]})})})}}}]);