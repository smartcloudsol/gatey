"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[788],{514(e,s,t){async function i(e,s,t,i,l){const n=await fetch(`${e}/account/${s}/site/${t}/settings`,{method:"PUT",headers:{"Content-Type":"application/json","X-Site-Key":i,"X-Plugin":"gatey"},body:JSON.stringify({settings:l})});if(!n.ok){const e=await n.text();throw new Error(e||`HTTP error! status: ${n.status}`)}return(await n.json()).settings}t.d(s,{D:()=>i})},788(e,s,t){t.r(s),t.d(s,{default:()=>C});var i=t(571),l=t(790),n=t(164),a=t(84),o=t(723),r=t(641),d=t(280),c=t(287),m=t(693),u=t(449),f=t(285),x=t(225),p=t(988),g=t(609),h=t(354),j=t(514),y=t(226),v=t(761);const b=["text","checkbox","radio","password","tel","country","select"],I={id:h.YjP(),name:h.YjP().min(1,"Name is required"),type:h.k5n(b),values:h.YOg(h.Ikc({value:h.YjP().transform(e=>e.trim()),label:h.YjP().transform(e=>e.trim())})).optional()},F=h.Ikc({formFields:h.YOg(h.Ikc(I))}),k={formFields:[]};function C({apiUrl:e,config:s,accountId:t,siteId:i,siteKey:n,onSave:c,InfoLabelComponent:u}){const[f,x]=(0,g.useState)(!1),[h,b]=(0,g.useState)(!1),I=(0,l.useForm)({mode:"uncontrolled",initialValues:{...k},validate:(0,p.s)(F)}),C=(0,g.useCallback)(async d=>{if(t&&i&&n){b(!0);try{const r=[];d.formFields.forEach(e=>{"string"!=typeof e&&e.name&&(r.push({name:"custom:"+e.name,type:e.type||"text"}),void 0!==e.values&&(r[r.length-1].values=e.values))});const u={...s,formFields:r};delete u.subscriptionType;const f=await(0,j.D)(e,t,i,n,u);c(f),l.notifications.show({title:(0,o.__)("Settings saved",a.Xg),message:(0,o.__)("Form field settings saved successfully",a.Xg),color:"green",icon:(0,v.jsx)(m.A,{}),className:y.A.notification})}catch(e){console.error("Error saving form field settings:",e),l.notifications.show({title:(0,o.__)("Error occured",a.Xg),message:e.message,color:"red",icon:(0,v.jsx)(r.A,{}),className:y.A.notification})}finally{b(!1)}}else console.error("Missing account ID or site ID or site key")},[t,i,n,s,e,c]);return(0,g.useEffect)(()=>{if(!f&&s){const e={formFields:[]};if(s.formFields){const t=[];s.formFields.forEach(e=>{const s=I.getValues().formFields||[],i=e.name.replace(/^custom:/,""),n=s.find(e=>e.name===i);t.push({id:n?.id||(0,l.randomId)(),name:i,type:e.type||"text",values:e.values?e.values.filter(e=>e.value&&e.label).map(e=>({value:e.value,label:e.label})):void 0})}),e.formFields=t}I.setValues(e),x(!0)}},[s,I,f]),(0,g.useEffect)(()=>{s&&x(!1)},[s]),(0,v.jsxs)("form",{onSubmit:I.onSubmit(C),children:[0===I.getValues().formFields.length?(0,v.jsx)(S,{form:I,formValuesSet:f}):(0,v.jsx)($,{form:I,formValuesSet:f,InfoLabelComponent:u}),(0,v.jsx)(l.Group,{justify:"flex-end",mt:"xl",children:(0,v.jsx)(l.Button,{type:"submit",variant:"gradient",loading:h,leftSection:(0,v.jsx)(d.A,{size:16}),children:"Save Custom Field Configuration"})})]})}function S({form:e}){const s=e.getValues().formFields,[,t]=(0,l.useListState)(s||[]);return(0,v.jsxs)(l.Stack,{align:"center",gap:"md",py:"xl",mb:"lg",bg:"gray.1",style:{borderRadius:"5px"},children:[(0,v.jsx)(l.Title,{order:5,children:"No Form Fields Configured"}),(0,v.jsx)(l.Text,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any form fields yet."}),(0,v.jsx)(l.Button,{variant:"gradient",size:"xs",leftSection:(0,v.jsx)(f.A,{}),onClick:()=>{const s={id:(0,l.randomId)(),name:"",type:"text"};t.append(s),e.insertListItem("formFields",s)},children:"Add Form Field"})]})}function $({form:e,formValuesSet:s,InfoLabelComponent:t}){const a=e.getValues().formFields,[o,r]=(0,l.useListState)(a||[]),d=(0,g.useCallback)(()=>{const s={id:(0,l.randomId)(),name:"",type:"text"};r.append(s),e.insertListItem("formFields",s)},[e,r]),m=(0,g.useCallback)(()=>{o.forEach((s,t)=>{const i=a.findIndex(e=>e.id===s.id);-1!==i?e.setFieldValue(`formFields.${i}.order`,t+1):console.warn(`Field with id ${s.id} not found in original fields array`)})},[a,e,o]);return(0,g.useEffect)(()=>{s&&r.setState(e.getValues().formFields.map(e=>({...e})))},[e,s,r]),(0,v.jsxs)(l.Stack,{gap:"md",mb:"lg",children:[(0,v.jsx)(i.JY,{onDragEnd:({destination:e,source:s})=>{r.reorder({from:s.index,to:e?.index||0}),m()},children:(0,v.jsx)(i.gL,{droppableId:"dnd-list",direction:"vertical",isDropDisabled:!0,children:s=>(0,v.jsxs)("div",{...s.droppableProps,ref:s.innerRef,children:[o.map((s,l)=>(0,v.jsx)(i.sx,{index:l,draggableId:s.id,isDragDisabled:!0,children:(i,l)=>(0,v.jsxs)("div",{className:(0,n.A)(y.A.item,{[y.A.itemDragging]:l.isDragging}),ref:i.innerRef,...i.draggableProps,children:[(0,v.jsx)("div",{...i.dragHandleProps,className:y.A.dragHandle,children:(0,v.jsx)(c.A,{size:18,stroke:1.5})}),(0,v.jsx)(w,{form:e,state:o,reorder:m,handlers:r,index:a.findIndex(e=>e.id===s.id),InfoLabelComponent:t},s.id)]})},s.id)),s.placeholder]})})}),(0,v.jsx)(l.Group,{justify:"center",children:(0,v.jsx)(l.Button,{variant:"subtle",size:"compact-xs",leftSection:(0,v.jsx)(u.A,{size:14}),w:"100%",mt:"0.3rem",onClick:d,children:"Add Form Field"})})]})}function w({form:e,state:s,handlers:t,reorder:i,index:n,InfoLabelComponent:a}){const o=`formFields.${n}`,r=e.getValues().formFields[n];return r&&("radio"===r.type||"select"===r.type?r.values&&Array.isArray(r.values)||(r.values=[]):r.values=void 0),(0,v.jsx)(l.Card,{shadow:"sm",w:"100%",withBorder:!0,children:(0,v.jsx)(l.Stack,{children:(0,v.jsxs)(l.Grid,{children:[(0,v.jsx)(l.Grid.Col,{span:6,style:{display:"flex",alignItems:"center"},children:(0,v.jsx)(l.TextInput,{label:(0,v.jsx)(a,{text:"Name",scrollToId:"field-name"}),placeholder:"Enter custom field name",...e.getInputProps(`${o}.name`),onBlur:()=>i(),style:{width:"100%"}},e.key(`${o}.name`))}),(0,v.jsx)(l.Grid.Col,{span:6,children:(0,v.jsx)(l.Select,{label:(0,v.jsx)(a,{text:"Type",scrollToId:"field-type"}),defaultValue:"text",data:b,...e.getInputProps(`${o}.type`),onChange:s=>{e.setFieldValue(`${o}.type`,s||"text"),i()}},e.key(`${o}.type`))}),("radio"===r?.type||"select"===r?.type)&&(0,v.jsxs)(l.Card,{withBorder:!0,m:"xs",p:"xs",w:"100%",h:"100%",children:[(0,v.jsxs)(l.Card.Section,{p:"md",children:[(0,v.jsx)(l.Text,{size:"sm",fw:500,component:"div",children:(0,v.jsx)(a,{text:"Options",scrollToId:"field-options"})}),(0,v.jsx)(l.Text,{c:"dimmed",size:"xs",children:"Add options for radio or select fields. Each option must have a label and a value."})]}),r.values?.map((s,t)=>(0,v.jsxs)(l.Flex,{direction:"row",gap:"xs",align:"center",children:[(0,v.jsx)(l.TextInput,{label:"Value",...e.getInputProps(`${o}.values.${t}.value`)},e.key(`${o}.values.${t}.value`)),(0,v.jsx)(l.TextInput,{label:"Label",...e.getInputProps(`${o}.values.${t}.label`)},e.key(`${o}.values.${t}.label`)),(0,v.jsx)(l.Button,{variant:"subtle",size:"xs",mt:"0.3rem",onClick:()=>e.removeListItem(`${o}.values`,t),children:(0,v.jsx)(x.A,{size:14,color:"red"})})]},e.key(`${o}.values.${t}`))),(0,v.jsx)(l.Button,{variant:"subtle",mt:"xs",size:"xs",leftSection:(0,v.jsx)(u.A,{size:14}),onClick:()=>{e.insertListItem(`${o}.values`,{id:(0,l.randomId)(),value:"",label:""})},children:"Add Option"})]}),(0,v.jsx)(l.Grid.Col,{span:6,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,v.jsx)(l.Tooltip,{label:"Delete Form Field",children:(0,v.jsx)(l.ActionIcon,{color:"red",variant:"subtle","aria-label":"Delete Form Field",onClick:()=>{const l=e.getValues().formFields[n];e.removeListItem("formFields",n),t.remove(s.findIndex(e=>e.id===l.id)),i()},children:(0,v.jsx)(x.A,{size:"1rem"})})})})]})})})}}}]);