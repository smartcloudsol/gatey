"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[788],{4788(e,s,t){t.r(s),t.d(s,{default:()=>A});var i=t(6252),n=t(8790),l=t(571),a=t(4164),r=t(7723),o=t(1529),d=t(7641),c=t(899),m=t(9287),u=t(7693),f=t(2342),x=t(2449),p=t(8285),g=t(4225),h=t(988),j=t(1609),y=t(8354),v=t(3226),b=t(790);const I=["text","checkbox","radio","password","tel","country","select"],F={id:y.YjP(),name:y.YjP().min(1,"Name is required"),type:y.k5n(I),values:y.YOg(y.Ikc({value:y.YjP().transform(e=>e.trim()),label:y.YjP().transform(e=>e.trim())})).optional()},C=y.Ikc({formFields:y.YOg(y.Ikc(F))}),k={formFields:[]};function A({amplifyConfigured:e,config:s,accountId:t,siteId:l,siteKey:a,onSave:m,InfoLabelComponent:x}){const[p,g]=(0,j.useState)(!1),[y,I]=(0,j.useState)(!1),F=(0,n.useForm)({mode:"uncontrolled",initialValues:{...k},validate:(0,h.s)(C)}),A=(0,j.useCallback)(async e=>{if(t&&l&&a){I(!0);try{const d=[];e.formFields.forEach(e=>{"string"!=typeof e&&e.name&&(d.push({name:"custom:"+e.name,type:e.type||"text"}),void 0!==e.values&&(d[d.length-1].values=e.values))});const c={...s,formFields:d};delete c.subscriptionType;const f=await async function(e,s,t,n){const l=(0,i.yJ)({apiName:"backend",path:`/account/${e}/site/${s}/settings`,options:{body:{settings:n},headers:{"X-Site-Key":t,"X-Plugin":"gatey"}}}),a=await l.response;if(a.statusCode<200||a.statusCode>=300)throw new Error(a.body.toString());return(await a.body.json()).settings}(t,l,a,c);m(f),n.notifications.show({title:(0,r.__)("Settings saved",o.Xg),message:(0,r.__)("Form field settings saved successfully",o.Xg),color:"green",icon:(0,b.jsx)(u.A,{}),className:v.A.notification})}catch(e){console.error("Error saving form field settings:",e),n.notifications.show({title:(0,r.__)("Error occured",o.Xg),message:e.message,color:"red",icon:(0,b.jsx)(d.A,{}),className:v.A.notification})}finally{I(!1)}}else console.error("Missing account ID or site ID or site key")},[t,l,a,s,m]);return(0,j.useEffect)(()=>{if(!p&&s){const e={formFields:[]};if(s.formFields){const t=[];s.formFields.forEach(e=>{const s=F.getValues().formFields||[],i=e.name.replace(/^custom:/,""),l=s.find(e=>e.name===i);t.push({id:l?.id||(0,n.randomId)(),name:i,type:e.type||"text",values:e.values?e.values.filter(e=>e.value&&e.label).map(e=>({value:e.value,label:e.label})):void 0})}),e.formFields=t}F.setValues(e),g(!0)}},[s,F,p]),(0,j.useEffect)(()=>{s&&g(!1)},[s]),(0,b.jsxs)("form",{onSubmit:F.onSubmit(A),children:[0===F.getValues().formFields.length?(0,b.jsx)(S,{form:F,formValuesSet:p}):(0,b.jsx)(w,{form:F,formValuesSet:p,InfoLabelComponent:x}),(0,b.jsxs)(n.Group,{justify:"flex-end",mt:"xl",children:[(0,b.jsx)(n.Button,{type:"submit",variant:"gradient",loading:y,leftSection:(0,b.jsx)(c.A,{size:16}),disabled:!e,children:"Save Custom Field Configuration"}),!e&&(0,b.jsxs)(n.HoverCard,{children:[(0,b.jsx)(n.HoverCard.Target,{children:(0,b.jsx)(n.ActionIcon,{variant:"subtle",size:"xs",children:(0,b.jsx)(f.A,{size:16,color:"red"})})}),(0,b.jsx)(n.HoverCard.Dropdown,{maw:300,style:{zIndex:1e4},children:(0,b.jsxs)(n.Text,{size:"sm",children:[(0,b.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]})}function S({form:e}){const s=e.getValues().formFields,[,t]=(0,n.useListState)(s||[]);return(0,b.jsxs)(n.Stack,{align:"center",gap:"md",py:"xl",mb:"lg",bg:"gray.1",style:{borderRadius:"5px"},children:[(0,b.jsx)(n.Title,{order:5,children:"No Form Fields Configured"}),(0,b.jsx)(n.Text,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any form fields yet."}),(0,b.jsx)(n.Button,{variant:"gradient",size:"xs",leftSection:(0,b.jsx)(p.A,{}),onClick:()=>{const s={id:(0,n.randomId)(),name:"",type:"text"};t.append(s),e.insertListItem("formFields",s)},children:"Add Form Field"})]})}function w({form:e,formValuesSet:s,InfoLabelComponent:t}){const i=e.getValues().formFields,[r,o]=(0,n.useListState)(i||[]),d=(0,j.useCallback)(()=>{const s={id:(0,n.randomId)(),name:"",type:"text"};o.append(s),e.insertListItem("formFields",s)},[e,o]),c=(0,j.useCallback)(()=>{r.forEach((s,t)=>{const n=i.findIndex(e=>e.id===s.id);-1!==n?e.setFieldValue(`formFields.${n}.order`,t+1):console.warn(`Field with id ${s.id} not found in original fields array`)})},[i,e,r]);return(0,j.useEffect)(()=>{s&&o.setState(e.getValues().formFields.map(e=>({...e})))},[e,s,o]),(0,b.jsxs)(n.Stack,{gap:"md",mb:"lg",children:[(0,b.jsx)(l.JY,{onDragEnd:({destination:e,source:s})=>{o.reorder({from:s.index,to:e?.index||0}),c()},children:(0,b.jsx)(l.gL,{droppableId:"dnd-list",direction:"vertical",isDropDisabled:!0,children:s=>(0,b.jsxs)("div",{...s.droppableProps,ref:s.innerRef,children:[r.map((s,n)=>(0,b.jsx)(l.sx,{index:n,draggableId:s.id,isDragDisabled:!0,children:(n,l)=>(0,b.jsxs)("div",{className:(0,a.A)(v.A.item,{[v.A.itemDragging]:l.isDragging}),ref:n.innerRef,...n.draggableProps,children:[(0,b.jsx)("div",{...n.dragHandleProps,className:v.A.dragHandle,children:(0,b.jsx)(m.A,{size:18,stroke:1.5})}),(0,b.jsx)($,{form:e,state:r,reorder:c,handlers:o,index:i.findIndex(e=>e.id===s.id),InfoLabelComponent:t},s.id)]})},s.id)),s.placeholder]})})}),(0,b.jsx)(n.Group,{justify:"center",children:(0,b.jsx)(n.Button,{variant:"subtle",size:"compact-xs",leftSection:(0,b.jsx)(x.A,{size:14}),w:"100%",mt:"0.3rem",onClick:d,children:"Add Form Field"})})]})}function $({form:e,state:s,handlers:t,reorder:i,index:l,InfoLabelComponent:a}){const r=`formFields.${l}`,o=e.getValues().formFields[l];return o&&("radio"===o.type||"select"===o.type?o.values&&Array.isArray(o.values)||(o.values=[]):o.values=void 0),(0,b.jsx)(n.Card,{shadow:"sm",w:"100%",withBorder:!0,children:(0,b.jsx)(n.Stack,{children:(0,b.jsxs)(n.Grid,{children:[(0,b.jsx)(n.Grid.Col,{span:6,style:{display:"flex",alignItems:"center"},children:(0,b.jsx)(n.TextInput,{label:(0,b.jsx)(a,{text:"Name",scrollToId:"field-name"}),placeholder:"Enter custom field name",...e.getInputProps(`${r}.name`),onBlur:()=>i(),style:{width:"100%"}},e.key(`${r}.name`))}),(0,b.jsx)(n.Grid.Col,{span:6,children:(0,b.jsx)(n.Select,{label:(0,b.jsx)(a,{text:"Type",scrollToId:"field-type"}),defaultValue:"text",data:I,...e.getInputProps(`${r}.type`),onChange:s=>{e.setFieldValue(`${r}.type`,s||"text"),i()}},e.key(`${r}.type`))}),("radio"===o?.type||"select"===o?.type)&&(0,b.jsxs)(n.Card,{withBorder:!0,m:"xs",p:"xs",w:"100%",h:"100%",children:[(0,b.jsxs)(n.Card.Section,{p:"md",children:[(0,b.jsx)(n.Text,{size:"sm",fw:500,component:"div",children:(0,b.jsx)(a,{text:"Options",scrollToId:"field-options"})}),(0,b.jsx)(n.Text,{c:"dimmed",size:"xs",children:"Add options for radio or select fields. Each option must have a label and a value."})]}),o.values?.map((s,t)=>(0,b.jsxs)(n.Flex,{direction:"row",gap:"xs",align:"center",children:[(0,b.jsx)(n.TextInput,{label:"Value",...e.getInputProps(`${r}.values.${t}.value`)},e.key(`${r}.values.${t}.value`)),(0,b.jsx)(n.TextInput,{label:"Label",...e.getInputProps(`${r}.values.${t}.label`)},e.key(`${r}.values.${t}.label`)),(0,b.jsx)(n.Button,{variant:"subtle",size:"xs",mt:"0.3rem",onClick:()=>e.removeListItem(`${r}.values`,t),children:(0,b.jsx)(g.A,{size:14,color:"red"})})]},e.key(`${r}.values.${t}`))),(0,b.jsx)(n.Button,{variant:"subtle",mt:"xs",size:"xs",leftSection:(0,b.jsx)(x.A,{size:14}),onClick:()=>{e.insertListItem(`${r}.values`,{id:(0,n.randomId)(),value:"",label:""})},children:"Add Option"})]}),(0,b.jsx)(n.Grid.Col,{span:6,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,b.jsx)(n.Tooltip,{label:"Delete Form Field",children:(0,b.jsx)(n.ActionIcon,{color:"red",variant:"subtle","aria-label":"Delete Form Field",onClick:()=>{const n=e.getValues().formFields[l];e.removeListItem("formFields",l),t.remove(s.findIndex(e=>e.id===n.id)),i()},children:(0,b.jsx)(g.A,{size:"1rem"})})})})]})})})}}}]);