"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[788],{74788:(e,s,i)=>{i.r(s),i.d(s,{default:()=>M});var t=i(94285),l=i(64999),n=i(5055),a=i(14598),r=i(48324),o=i(17826),d=i(69019),c=i(89652),m=i(31179),u=i(49674),f=i(57193),x=i(77828),p=i(40054),g=i(4039),h=i(69329),j=i(9543),y=i(45727),v=i(6447),b=i(45382),F=i(34164),I=i(27723),$=i(70544),k=i(57693),C=i(7641),A=i(20899),w=i(22342),z=i(48285),E=i(29287),S=i(42449),_=i(4225),V=i(30988),D=i(51609),T=i(87909),L=i(43226),P=i(10790);const N=["text","checkbox","radio","password","tel","country","select"],Y={id:T.YjP(),name:T.YjP().min(1,"Name is required"),type:T.k5n(N),values:T.YOg(T.Ikc({value:T.YjP().transform((e=>e.trim())),label:T.YjP().transform((e=>e.trim()))})).optional()},O=T.Ikc({formFields:T.YOg(T.Ikc(Y))}),B={formFields:[]};function M({amplifyConfigured:e,config:s,accountId:i,siteId:d,siteKey:c,onSave:m,InfoLabelComponent:u}){const[f,x]=(0,D.useState)(!1),[p,g]=(0,D.useState)(!1),v=(0,h.m)({mode:"uncontrolled",initialValues:{...B},validate:(0,V.s)(O)}),b=(0,D.useCallback)((async e=>{if(i&&d&&c){g(!0);try{const l=[];e.formFields.forEach((e=>{"string"!=typeof e&&e.name&&(l.push({name:"custom:"+e.name,type:e.type||"text"}),void 0!==e.values&&(l[l.length-1].values=e.values))}));const n={...s,formFields:l};delete n.subscriptionType;const a=await async function(e,s,i,l){const n=(0,t.yJ)({apiName:"backend",path:`/account/${e}/site/${s}/settings`,options:{body:{settings:l},headers:{"X-Site-Key":i}}}),a=await n.response;if(a.statusCode<200||a.statusCode>=300)throw new Error(a.body.toString());return(await a.body.json()).settings}(i,d,c,n);m(a),j.$e.show({title:(0,I.__)("Settings saved",$.TEXT_DOMAIN),message:(0,I.__)("Form field settings saved successfully",$.TEXT_DOMAIN),color:"green",icon:(0,P.jsx)(k.A,{}),className:L.A.notification})}catch(e){console.error("Error saving form field settings:",e),j.$e.show({title:(0,I.__)("Error occured",$.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,P.jsx)(C.A,{}),className:L.A.notification})}finally{g(!1)}}else console.error("Missing account ID or site ID or site key")}),[i,d,c,s,m]);return(0,D.useEffect)((()=>{if(!f&&s){const e={formFields:[]};if(s.formFields){const i=[];s.formFields.forEach((e=>{const s=v.getValues().formFields||[],t=e.name.replace(/^custom:/,""),l=s.find((e=>e.name===t));i.push({id:l?.id||(0,y.z)(),name:t,type:e.type||"text",values:e.values?e.values.filter((e=>e.value&&e.label)).map((e=>({value:e.value,label:e.label}))):void 0})})),e.formFields=i}v.setValues(e),x(!0)}}),[s,v,f]),(0,D.useEffect)((()=>{s&&x(!1)}),[s]),(0,P.jsxs)("form",{onSubmit:v.onSubmit(b),children:[0===v.getValues().formFields.length?(0,P.jsx)(X,{form:v,formValuesSet:f}):(0,P.jsx)(H,{form:v,formValuesSet:f,InfoLabelComponent:u}),(0,P.jsxs)(l.Y,{justify:"flex-end",mt:"xl",children:[(0,P.jsx)(n.$,{type:"submit",variant:"gradient",loading:p,leftSection:(0,P.jsx)(A.A,{size:16}),disabled:!e,children:"Save Custom Field Configuration"}),!e&&(0,P.jsxs)(a.j,{children:[(0,P.jsx)(a.j.Target,{children:(0,P.jsx)(r.M,{variant:"subtle",size:"xs",children:(0,P.jsx)(w.A,{size:16,color:"red"})})}),(0,P.jsx)(a.j.Dropdown,{maw:300,style:{zIndex:1e4},children:(0,P.jsxs)(o.E,{size:"sm",children:[(0,P.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]})}function X({form:e}){const s=e.getValues().formFields,[,i]=(0,v.p)(s||[]);return(0,P.jsxs)(d.B,{align:"center",gap:"md",py:"xl",mb:"lg",bg:"gray.1",style:{borderRadius:"5px"},children:[(0,P.jsx)(c.h,{order:5,children:"No Form Fields Configured"}),(0,P.jsx)(o.E,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any form fields yet."}),(0,P.jsx)(n.$,{variant:"gradient",size:"xs",leftSection:(0,P.jsx)(z.A,{}),onClick:()=>{const s={id:(0,y.z)(),name:"",type:"text"};i.append(s),e.insertListItem("formFields",s)},children:"Add Form Field"})]})}function H({form:e,formValuesSet:s,InfoLabelComponent:i}){const t=e.getValues().formFields,[a,r]=(0,v.p)(t||[]),o=(0,D.useCallback)((()=>{const s={id:(0,y.z)(),name:"",type:"text"};r.append(s),e.insertListItem("formFields",s)}),[e,r]),c=(0,D.useCallback)((()=>{a.forEach(((s,i)=>{const l=t.findIndex((e=>e.id===s.id));-1!==l?e.setFieldValue(`formFields.${l}.order`,i+1):console.warn(`Field with id ${s.id} not found in original fields array`)}))}),[t,e,a]);return(0,D.useEffect)((()=>{s&&r.setState(e.getValues().formFields.map((e=>({...e}))))}),[e,s,r]),(0,P.jsxs)(d.B,{gap:"md",mb:"lg",children:[(0,P.jsx)(b.JY,{onDragEnd:({destination:e,source:s})=>{r.reorder({from:s.index,to:e?.index||0}),c()},children:(0,P.jsx)(b.gL,{droppableId:"dnd-list",direction:"vertical",isDropDisabled:!0,children:s=>(0,P.jsxs)("div",{...s.droppableProps,ref:s.innerRef,children:[a.map(((s,l)=>(0,P.jsx)(b.sx,{index:l,draggableId:s.id,isDragDisabled:!0,children:(l,n)=>(0,P.jsxs)("div",{className:(0,F.A)(L.A.item,{[L.A.itemDragging]:n.isDragging}),ref:l.innerRef,...l.draggableProps,children:[(0,P.jsx)("div",{...l.dragHandleProps,className:L.A.dragHandle,children:(0,P.jsx)(E.A,{size:18,stroke:1.5})}),(0,P.jsx)(R,{form:e,state:a,reorder:c,handlers:r,index:t.findIndex((e=>e.id===s.id)),InfoLabelComponent:i},s.id)]})},s.id))),s.placeholder]})})}),(0,P.jsx)(l.Y,{justify:"center",children:(0,P.jsx)(n.$,{variant:"subtle",size:"compact-xs",leftSection:(0,P.jsx)(S.A,{size:14}),w:"100%",mt:"0.3rem",onClick:o,children:"Add Form Field"})})]})}function R({form:e,state:s,handlers:i,reorder:t,index:l,InfoLabelComponent:a}){const c=`formFields.${l}`,h=e.getValues().formFields[l];return h&&("radio"===h.type||"select"===h.type?h.values&&Array.isArray(h.values)||(h.values=[]):h.values=void 0),(0,P.jsx)(m.Z,{shadow:"sm",w:"100%",withBorder:!0,children:(0,P.jsx)(d.B,{children:(0,P.jsxs)(u.x,{children:[(0,P.jsx)(u.x.Col,{span:6,style:{display:"flex",alignItems:"center"},children:(0,P.jsx)(f.k,{label:(0,P.jsx)(a,{text:"Name",scrollToId:"field-name"}),placeholder:"Enter custom field name",...e.getInputProps(`${c}.name`),onBlur:()=>t(),style:{width:"100%"}},e.key(`${c}.name`))}),(0,P.jsx)(u.x.Col,{span:6,children:(0,P.jsx)(x.l,{label:(0,P.jsx)(a,{text:"Type",scrollToId:"field-type"}),defaultValue:"text",data:N,...e.getInputProps(`${c}.type`),onChange:s=>{e.setFieldValue(`${c}.type`,s||"text"),t()}},e.key(`${c}.type`))}),("radio"===h?.type||"select"===h?.type)&&(0,P.jsxs)(m.Z,{withBorder:!0,m:"xs",p:"xs",w:"100%",h:"100%",children:[(0,P.jsxs)(m.Z.Section,{p:"md",children:[(0,P.jsx)(o.E,{size:"sm",fw:500,component:"div",children:(0,P.jsx)(a,{text:"Options",scrollToId:"field-options"})}),(0,P.jsx)(o.E,{c:"dimmed",size:"xs",children:"Add options for radio or select fields. Each option must have a label and a value."})]}),h.values?.map(((s,i)=>(0,P.jsxs)(p.s,{direction:"row",gap:"xs",align:"center",children:[(0,P.jsx)(f.k,{label:"Value",...e.getInputProps(`${c}.values.${i}.value`)},e.key(`${c}.values.${i}.value`)),(0,P.jsx)(f.k,{label:"Label",...e.getInputProps(`${c}.values.${i}.label`)},e.key(`${c}.values.${i}.label`)),(0,P.jsx)(n.$,{variant:"subtle",size:"xs",mt:"0.3rem",onClick:()=>e.removeListItem(`${c}.values`,i),children:(0,P.jsx)(_.A,{size:14,color:"red"})})]},e.key(`${c}.values.${i}`)))),(0,P.jsx)(n.$,{variant:"subtle",mt:"xs",size:"xs",leftSection:(0,P.jsx)(S.A,{size:14}),onClick:()=>{e.insertListItem(`${c}.values`,{id:(0,y.z)(),value:"",label:""})},children:"Add Option"})]}),(0,P.jsx)(u.x.Col,{span:6,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,P.jsx)(g.m,{label:"Delete Form Field",children:(0,P.jsx)(r.M,{color:"red",variant:"subtle","aria-label":"Delete Form Field",onClick:()=>{const n=e.getValues().formFields[l];e.removeListItem("formFields",l),i.remove(s.findIndex((e=>e.id===n.id))),t()},children:(0,P.jsx)(_.A,{size:"1rem"})})})})]})})})}}}]);