"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[181],{5181(e,n,o){o.r(n),o.d(n,{default:()=>A});var a=o(6252),i=o(8790),t=o(7723);const s=(0,o(8728).A)("outline","moneybag-heart","MoneybagHeart",[["path",{d:"M9.5 3h5a1.5 1.5 0 0 1 1.5 1.5a3.5 3.5 0 0 1 -3.5 3.5h-1a3.5 3.5 0 0 1 -3.5 -3.5a1.5 1.5 0 0 1 1.5 -1.5",key:"svg-0"}],["path",{d:"M11.5 21h-3.5a4 4 0 0 1 -4 -4v-1a8 8 0 0 1 14.376 -4.833",key:"svg-1"}],["path",{d:"M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.24 2.24 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.24 2.24 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296",key:"svg-2"}]]);var r=o(7641),l=o(4805),d=o(9568),c=o(899),u=o(4225),p=o(6118),g=o(2449),m=o(8285),h=o(988),x=o(1609),f=o(8354),j=o(3226),y=o(1529),b=o(790);const k=f.Ikc({key:f.YjP(),name:f.YjP().min(2),endpoint:f.YjP().min(2).url(),region:f.YjP().optional(),authorization:f.k5n(["IAM","ACCESS_TOKEN","ID_TOKEN"])}),I=f.Ikc({key:f.YjP(),name:f.YjP(),value:f.YjP()}),C=f.Ikc({apiName:f.YjP(),path:f.YjP(),options:f.Ikc({withCredentials:f.zMY(),headers:f.YOg(I).refine(e=>{const n=e.map(e=>e.name);return new Set(n).size===n.length},{message:"Header names must be unique"}),queryParams:f.YOg(I).refine(e=>{const n=e.map(e=>e.name);return new Set(n).size===n.length},{message:"Query parameter names must be unique"})})}),T=f.Ikc({apiConfiguration:f.Ikc({default:f.Ikc({apis:f.YOg(k),signInHook:C.optional(),signOutHook:C.optional()}),secondary:f.Ikc({domains:f.YjP(),apis:f.YOg(k),signInHook:C.optional(),signOutHook:C.optional()})})});function A({amplifyConfigured:e,config:n,accountId:o,siteId:u,siteKey:p,onSave:g,InfoLabelComponent:m}){const[f,k]=(0,x.useState)(!1),[I,C]=(0,x.useState)(!1),A=(0,i.useForm)({mode:"uncontrolled",initialValues:{apiConfiguration:{default:{apis:[]},secondary:{domains:"",apis:[]}}},validate:(0,h.s)(T)}),P=(0,x.useCallback)(e=>e?Object.entries(e).map(([e,n])=>({key:(0,i.randomId)(),name:e,value:n})):[],[]),w=(0,x.useCallback)(e=>e?e.reduce((e,n)=>(n.name&&(e[n.name]=n.value),e),{}):{},[]),z=(0,x.useCallback)(e=>{if(e)return{apiName:e.apiName,path:e.path,options:{withCredentials:e.options.withCredentials,headers:w(e.options.headers),queryParams:w(e.options.queryParams)}}},[w]),H=(0,x.useCallback)(e=>{if(e)return{apiName:e.apiName,path:e.path,options:{withCredentials:e.options?.withCredentials||!1,headers:P(e.options?.headers),queryParams:P(e.options?.queryParams)}}},[P]),S=(0,x.useCallback)(async e=>{if(o&&u&&p){C(!0);try{const r={...n,apiConfigurations:{default:{apis:e.apiConfiguration.default.apis.map(e=>({name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:z(e.apiConfiguration.default.signInHook),signOutHook:z(e.apiConfiguration.default.signOutHook)},secondary:e.apiConfiguration.secondary.apis?{domains:e.apiConfiguration.secondary.domains,apis:e.apiConfiguration.secondary.apis.map(e=>({name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:z(e.apiConfiguration.secondary.signInHook),signOutHook:z(e.apiConfiguration.secondary.signOutHook)}:void 0}};delete r.subscriptionType;const l=await async function(e,n,o,i){const t=(0,a.yJ)({apiName:"backend",path:`/account/${e}/site/${n}/settings`,options:{body:{settings:i},headers:{"X-Site-Key":o,"X-Plugin":"gatey"}}}),s=await t.response;if(s.statusCode<200||s.statusCode>=300)throw new Error(s.body.toString());return(await s.body.json()).settings}(o,u,p,r);g(l),i.notifications.show({title:(0,t.__)("Settings saved",y.Xg),message:(0,t.__)("API settings saved successfully.",y.Xg),color:"green",icon:(0,b.jsx)(s,{}),className:j.A.notification})}catch(e){console.error("Error saving API settings:",e),i.notifications.show({title:(0,t.__)("Error occured",y.Xg),message:e.message,color:"red",icon:(0,b.jsx)(r.A,{}),className:j.A.notification})}finally{C(!1)}}else console.error("Missing account ID or site ID or site key")},[o,n,g,u,p,z]);return(0,x.useEffect)(()=>{if(!f&&n){k(!0);const e={apiConfiguration:{default:{apis:(n.apiConfigurations?.default?.apis||[]).map(e=>({key:(0,i.randomId)(),name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:H(n.apiConfigurations?.default?.signInHook),signOutHook:H(n.apiConfigurations?.default?.signOutHook)},secondary:{domains:n.apiConfigurations?.secondary?.domains||"",apis:(n.apiConfigurations?.secondary?.apis||[]).map(e=>({key:(0,i.randomId)(),name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:H(n.apiConfigurations?.secondary?.signInHook),signOutHook:H(n.apiConfigurations?.secondary?.signOutHook)}}};A.setValues(e)}},[n,A,H,f]),(0,x.useEffect)(()=>{n&&k(!1)},[n]),(0,b.jsxs)("form",{name:"apisettings-editor",onSubmit:A.onSubmit(S),children:[(0,b.jsxs)(i.Tabs,{defaultValue:"default",mb:"lg",children:[(0,b.jsxs)(i.Tabs.List,{children:[(0,b.jsx)(i.Tabs.Tab,{value:"default",leftSection:(0,b.jsx)(l.A,{size:16}),children:(0,b.jsx)(m,{text:"Default",scrollToId:"api-definitaions"})}),(0,b.jsx)(i.Tabs.Tab,{value:"secondary",leftSection:(0,b.jsx)(d.A,{size:16}),children:(0,b.jsx)(m,{text:"Secondary",scrollToId:"api-definitaions"})})]}),(0,b.jsx)(i.Tabs.Panel,{value:"default",p:"md",bg:"gray.1",children:(0,b.jsx)(v,{configKey:"default",form:A,InfoLabelComponent:m})}),(0,b.jsx)(i.Tabs.Panel,{value:"secondary",p:"md",bg:"gray.1",children:(0,b.jsx)(v,{configKey:"secondary",form:A,InfoLabelComponent:m})})]}),(0,b.jsxs)(i.Group,{justify:"flex-end",children:[(0,b.jsx)(i.Button,{type:"submit",variant:"gradient",loading:I,leftSection:(0,b.jsx)(c.A,{size:16}),disabled:!e,children:"Save API Configuration"}),!e&&(0,b.jsxs)(i.HoverCard,{children:[(0,b.jsx)(i.HoverCard.Target,{children:(0,b.jsx)(i.ActionIcon,{variant:"subtle",size:"xs",children:(0,b.jsx)(r.A,{size:16,color:"red"})})}),(0,b.jsx)(i.HoverCard.Dropdown,{maw:300,style:{zIndex:1e4},children:(0,b.jsxs)(i.Text,{size:"sm",children:["ðŸ›‘ ",(0,b.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]})}function v({configKey:e,form:n,InfoLabelComponent:o}){const a=n.getValues().apiConfiguration[e].apis;return(0,b.jsxs)(b.Fragment,{children:["secondary"===e&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Group,{gap:"xs",align:"center",mb:"sm",children:(0,b.jsx)(i.Title,{order:4,children:(0,b.jsx)(o,{text:"Domains",scrollToId:"api-domains"})})}),(0,b.jsx)(i.TextInput,{classNames:{label:j.A["form-field-label"]},withAsterisk:!0,...n.getInputProps("apiConfiguration."+e+".domains"),mb:"md"},n.key("apiConfiguration."+e+".domains"))]}),(0,b.jsx)(i.Group,{gap:"xs",align:"center",mb:"sm",children:(0,b.jsx)(i.Title,{order:4,children:"APIs"})}),(0,b.jsx)(z,{form:n,configKey:e,InfoLabelComponent:o}),(0,b.jsx)(i.Group,{gap:"xs",align:"center",mb:"sm",children:(0,b.jsx)(i.Title,{order:4,children:(0,b.jsx)(o,{text:"Hooks",scrollToId:"api-hooks"})})}),(0,b.jsxs)(i.Stack,{gap:"md",children:[0===a.length&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Title,{order:5,ta:"center",mt:"lg",children:"No Hooks Configured"}),(0,b.jsx)(i.Text,{c:"dimmed",size:"sm",ta:"center",mb:"lg",children:"You can configure hooks after adding at least one API."})]}),a.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(P,{title:"Sign In",form:n,configKey:e,hookKey:"signInHook",InfoLabelComponent:o}),(0,b.jsx)(P,{title:"Sign Out",form:n,configKey:e,hookKey:"signOutHook",InfoLabelComponent:o})]})]})]})}function P({title:e,form:n,configKey:o,hookKey:a,InfoLabelComponent:t}){const s=`apiConfiguration.${o}.${a}`,r=n.getValues().apiConfiguration[o].apis,l=!!n.getValues().apiConfiguration[o][a];return(0,b.jsx)(i.Card,{shadow:"sm",withBorder:!0,children:(0,b.jsxs)(i.Stack,{children:[(0,b.jsxs)(i.Group,{children:[(0,b.jsx)(i.Title,{order:5,style:{flexGrow:1},children:e}),l&&(0,b.jsx)(i.Tooltip,{label:"Delete Hook",children:(0,b.jsx)(i.ActionIcon,{color:"red",variant:"subtle","aria-label":"Delete Hook",onClick:()=>n.setFieldValue(s,void 0),children:(0,b.jsx)(u.A,{size:"1rem"})})}),!l&&(0,b.jsx)(i.Button,{variant:"subtle",size:"compact-xs",leftSection:(0,b.jsx)(p.A,{size:16}),onClick:()=>n.setFieldValue(s,{apiName:"",path:"",options:{withCredentials:!1,headers:[],queryParams:[]}}),children:"Configure"})]}),l&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(i.Group,{grow:!0,children:[(0,b.jsx)(i.Select,{classNames:{label:j.A["form-field-label"]},label:(0,b.jsx)(t,{text:"API",scrollToId:"hook-api"}),withAsterisk:!0,data:r.map(e=>e.name),...n.getInputProps(`${s}.apiName`)},n.key(`${s}.apiName`)),(0,b.jsx)(i.TextInput,{classNames:{label:j.A["form-field-label"]},label:(0,b.jsx)(t,{text:"Path",scrollToId:"hook-path"}),withAsterisk:!0,...n.getInputProps(`${s}.path`)},n.key(`${s}.path`))]}),(0,b.jsx)(i.Checkbox,{label:(0,b.jsx)(t,{text:"With Credentials",scrollToId:"hook-credentials"}),style:{flexGrow:1},...n.getInputProps(`${s}.options.withCredentials`,{type:"checkbox"})},n.key(`${s}.options.withCredentials`)),(0,b.jsx)(i.Title,{order:5,children:(0,b.jsx)(t,{text:"Headers",scrollToId:"hook-headers"})}),(0,b.jsx)(w,{form:n,configKey:o,hookKey:a,optionKey:"headers",addButtonLabel:"Add Header"}),(0,b.jsx)(i.Title,{order:5,children:(0,b.jsx)(t,{text:"Query Params",scrollToId:"hook-headers"})}),(0,b.jsx)(w,{form:n,configKey:o,hookKey:a,optionKey:"queryParams",addButtonLabel:"Add Query Param"})]})]})})}function w({form:e,configKey:n,hookKey:o,optionKey:a,addButtonLabel:t}){const s=`apiConfiguration.${n}.${o}.options.${a}`,r=e.getValues(),l=r.apiConfiguration[n][o]?.options?.[a];return(0,b.jsxs)(i.Box,{children:[(0,b.jsxs)(i.Table,{withTableBorder:!0,children:[(0,b.jsx)(i.Table.Thead,{children:(0,b.jsxs)(i.Table.Tr,{children:[(0,b.jsx)(i.Table.Th,{children:"Name"}),(0,b.jsx)(i.Table.Th,{children:"Value"}),(0,b.jsx)(i.Table.Th,{})]})}),(0,b.jsx)(i.Table.Tbody,{children:l?.map((n,o)=>(0,b.jsxs)(i.Table.Tr,{children:[(0,b.jsx)(i.Table.Td,{children:(0,b.jsx)("input",{type:"text",...e.getInputProps(`${s}.${o}.name`),style:{border:"none",padding:0,margin:0,fontSize:"13px",width:"100%"}},e.key(`${s}.${o}.name`))}),(0,b.jsx)(i.Table.Td,{children:(0,b.jsx)("input",{type:"text",...e.getInputProps(`${s}.${o}.value`),style:{border:"none",padding:0,margin:0,fontSize:"13px",width:"100%"}},e.key(`${s}.${o}.value`))}),(0,b.jsx)(i.Table.Td,{children:(0,b.jsx)(i.ActionIcon,{color:"red",variant:"subtle","aria-label":"Delete Header",onClick:()=>e.removeListItem(s,o),children:(0,b.jsx)(u.A,{size:"1rem"})})})]},n.key))})]}),(0,b.jsx)(i.Button,{variant:"subtle",size:"compact-xs",leftSection:(0,b.jsx)(g.A,{size:14}),w:"100%",mt:"0.3rem",onClick:()=>{e.insertListItem(s,{key:(0,i.randomId)(),name:"",value:""})},children:t})]})}function z({form:e,configKey:n,InfoLabelComponent:o}){const a=`apiConfiguration.${n}.apis`,t=e.getValues().apiConfiguration[n].apis,s=()=>{e.insertListItem(a,{key:(0,i.randomId)(),name:"",endpoint:"",region:"",authorization:"IAM"})};return t.length?(0,b.jsxs)(i.Stack,{gap:"md",mb:"lg",children:[t.map((a,i)=>(0,b.jsx)(H,{form:e,configKey:n,index:i,InfoLabelComponent:o},a.key)),(0,b.jsx)(i.Group,{justify:"center",children:(0,b.jsx)(i.Button,{variant:"subtle",size:"compact-xs",leftSection:(0,b.jsx)(g.A,{size:14}),w:"100%",mt:"0.3rem",onClick:s,children:"Add API"})})]}):(0,b.jsxs)(i.Stack,{align:"center",gap:"md",py:"xl",mb:"lg",children:[(0,b.jsx)(i.Title,{order:4,children:"No APIs Configured"}),(0,b.jsx)(i.Text,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any API definitions yet."}),(0,b.jsx)(i.Button,{variant:"gradient",size:"xs",leftSection:(0,b.jsx)(m.A,{}),onClick:s,children:"Add API"})]})}function H({form:e,configKey:n,index:o,InfoLabelComponent:a}){const t=`apiConfiguration.${n}.apis.${o}`;return(0,b.jsx)(i.Card,{shadow:"sm",withBorder:!0,children:(0,b.jsxs)(i.Stack,{children:[(0,b.jsxs)(i.Group,{grow:!0,children:[(0,b.jsx)(i.TextInput,{classNames:{label:j.A["form-field-label"]},label:(0,b.jsx)(a,{text:"Name",scrollToId:"api-name"}),withAsterisk:!0,...e.getInputProps(`${t}.name`)},e.key(`${t}.name`)),(0,b.jsx)(i.Select,{label:(0,b.jsx)(a,{text:"Authorization",scrollToId:"api-authorization"}),data:[{value:"IAM",label:"IAM"},{value:"ACCESS_TOKEN",label:"Access Token"},{value:"ID_TOKEN",label:"ID Token"}],defaultValue:"IAM",...e.getInputProps(`${t}.authorization`)},e.key(`${t}.authorization`))]}),(0,b.jsxs)(i.Group,{align:"center",children:[(0,b.jsx)(i.TextInput,{classNames:{label:j.A["form-field-label"]},label:(0,b.jsx)(a,{text:"Endpoint",scrollToId:"api-endpoint"}),withAsterisk:!0,...e.getInputProps(`${t}.endpoint`),style:{flexGrow:1}},e.key(`${t}.endpoint`)),(0,b.jsx)(i.Tooltip,{label:"Delete API",children:(0,b.jsx)(i.ActionIcon,{color:"red",variant:"subtle","aria-label":"Delete API",mt:"lg",onClick:()=>e.removeListItem(`apiConfiguration.${n}.apis`,o),children:(0,b.jsx)(u.A,{size:"1rem"})})})]}),(0,b.jsx)(i.Group,{align:"center",children:(0,b.jsx)(i.TextInput,{classNames:{label:j.A["form-field-label"]},label:(0,b.jsx)(a,{text:"Region",scrollToId:"api-region"}),...e.getInputProps(`${t}.region`),style:{flexGrow:1}},e.key(`${t}.region`))})]})})}},8285(e,n,o){o.d(n,{A:()=>a});const a=(0,o(8728).A)("outline","row-insert-bottom","RowInsertBottom",[["path",{d:"M20 6v4a1 1 0 0 1 -1 1h-14a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h14a1 1 0 0 1 1 1",key:"svg-0"}],["path",{d:"M12 15l0 4",key:"svg-1"}],["path",{d:"M14 17l-4 0",key:"svg-2"}]])}}]);