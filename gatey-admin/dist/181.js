"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[181],{75181(e,n,i){i.r(n),i.d(n,{default:()=>X});var a=i(6252),o=i(28008),s=i(64999),t=i(5055),r=i(14598),l=i(48324),d=i(17826),c=i(89652),u=i(57193),p=i(69019),m=i(31179),g=i(4039),h=i(77828),f=i(74533),x=i(11507),j=i(85091),y=i(69329),k=i(9543),b=i(45727),I=i(27723);const C=(0,i(38728).A)("outline","moneybag-heart","MoneybagHeart",[["path",{d:"M9.5 3h5a1.5 1.5 0 0 1 1.5 1.5a3.5 3.5 0 0 1 -3.5 3.5h-1a3.5 3.5 0 0 1 -3.5 -3.5a1.5 1.5 0 0 1 1.5 -1.5",key:"svg-0"}],["path",{d:"M11.5 21h-3.5a4 4 0 0 1 -4 -4v-1a8 8 0 0 1 14.376 -4.833",key:"svg-1"}],["path",{d:"M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.24 2.24 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.24 2.24 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071z",key:"svg-2"}]]);var A=i(7641),P=i(84805),z=i(49568),T=i(20899),w=i(4225),v=i(36118),$=i(42449),H=i(48285),K=i(30988),N=i(51609),S=i(8354),Y=i(43226),O=i(70544),_=i(10790);const L=S.Ikc({key:S.YjP(),name:S.YjP().min(2),endpoint:S.YjP().min(2).url(),region:S.YjP().optional(),authorization:S.k5n(["IAM","ACCESS_TOKEN","ID_TOKEN"])}),E=S.Ikc({key:S.YjP(),name:S.YjP(),value:S.YjP()}),M=S.Ikc({apiName:S.YjP(),path:S.YjP(),options:S.Ikc({withCredentials:S.zMY(),headers:S.YOg(E).refine(e=>{const n=e.map(e=>e.name);return new Set(n).size===n.length},{message:"Header names must be unique"}),queryParams:S.YOg(E).refine(e=>{const n=e.map(e=>e.name);return new Set(n).size===n.length},{message:"Query parameter names must be unique"})})}),D=S.Ikc({apiConfiguration:S.Ikc({default:S.Ikc({apis:S.YOg(L),signInHook:M.optional(),signOutHook:M.optional()}),secondary:S.Ikc({domains:S.YjP(),apis:S.YOg(L),signInHook:M.optional(),signOutHook:M.optional()})})});function X({amplifyConfigured:e,config:n,accountId:i,siteId:c,siteKey:u,onSave:p,InfoLabelComponent:m}){const[g,h]=(0,N.useState)(!1),[f,x]=(0,N.useState)(!1),j=(0,y.m)({mode:"uncontrolled",initialValues:{apiConfiguration:{default:{apis:[]},secondary:{domains:"",apis:[]}}},validate:(0,K.s)(D)}),w=(0,N.useCallback)(e=>e?Object.entries(e).map(([e,n])=>({key:(0,b.z)(),name:e,value:n})):[],[]),v=(0,N.useCallback)(e=>e?e.reduce((e,n)=>(n.name&&(e[n.name]=n.value),e),{}):{},[]),$=(0,N.useCallback)(e=>{if(e)return{apiName:e.apiName,path:e.path,options:{withCredentials:e.options.withCredentials,headers:v(e.options.headers),queryParams:v(e.options.queryParams)}}},[v]),H=(0,N.useCallback)(e=>{if(e)return{apiName:e.apiName,path:e.path,options:{withCredentials:e.options?.withCredentials||!1,headers:w(e.options?.headers),queryParams:w(e.options?.queryParams)}}},[w]),S=(0,N.useCallback)(async e=>{if(i&&c&&u){x(!0);try{const o={...n,apiConfigurations:{default:{apis:e.apiConfiguration.default.apis.map(e=>({name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:$(e.apiConfiguration.default.signInHook),signOutHook:$(e.apiConfiguration.default.signOutHook)},secondary:e.apiConfiguration.secondary.apis?{domains:e.apiConfiguration.secondary.domains,apis:e.apiConfiguration.secondary.apis.map(e=>({name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:$(e.apiConfiguration.secondary.signInHook),signOutHook:$(e.apiConfiguration.secondary.signOutHook)}:void 0}};delete o.subscriptionType;const s=await async function(e,n,i,o){const s=(0,a.yJ)({apiName:"backend",path:`/account/${e}/site/${n}/settings`,options:{body:{settings:o},headers:{"X-Site-Key":i}}}),t=await s.response;if(t.statusCode<200||t.statusCode>=300)throw new Error(t.body.toString());return(await t.body.json()).settings}(i,c,u,o);p(s),k.$e.show({title:(0,I.__)("Settings saved",O.TEXT_DOMAIN),message:(0,I.__)("API settings saved successfully.",O.TEXT_DOMAIN),color:"green",icon:(0,_.jsx)(C,{}),className:Y.A.notification})}catch(e){console.error("Error saving API settings:",e),k.$e.show({title:(0,I.__)("Error occured",O.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,_.jsx)(A.A,{}),className:Y.A.notification})}finally{x(!1)}}else console.error("Missing account ID or site ID or site key")},[i,n,p,c,u,$]);return(0,N.useEffect)(()=>{if(!g&&n){h(!0);const e={apiConfiguration:{default:{apis:(n.apiConfigurations?.default?.apis||[]).map(e=>({key:(0,b.z)(),name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:H(n.apiConfigurations?.default?.signInHook),signOutHook:H(n.apiConfigurations?.default?.signOutHook)},secondary:{domains:n.apiConfigurations?.secondary?.domains||"",apis:(n.apiConfigurations?.secondary?.apis||[]).map(e=>({key:(0,b.z)(),name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization})),signInHook:H(n.apiConfigurations?.secondary?.signInHook),signOutHook:H(n.apiConfigurations?.secondary?.signOutHook)}}};j.setValues(e)}},[n,j,H,g]),(0,N.useEffect)(()=>{n&&h(!1)},[n]),(0,_.jsxs)("form",{name:"apisettings-editor",onSubmit:j.onSubmit(S),children:[(0,_.jsxs)(o.t,{defaultValue:"default",mb:"lg",children:[(0,_.jsxs)(o.t.List,{children:[(0,_.jsx)(o.t.Tab,{value:"default",leftSection:(0,_.jsx)(P.A,{size:16}),children:(0,_.jsx)(m,{text:"Default",scrollToId:"api-definitaions"})}),(0,_.jsx)(o.t.Tab,{value:"secondary",leftSection:(0,_.jsx)(z.A,{size:16}),children:(0,_.jsx)(m,{text:"Secondary",scrollToId:"api-definitaions"})})]}),(0,_.jsx)(o.t.Panel,{value:"default",p:"md",bg:"gray.1",children:(0,_.jsx)(V,{configKey:"default",form:j,InfoLabelComponent:m})}),(0,_.jsx)(o.t.Panel,{value:"secondary",p:"md",bg:"gray.1",children:(0,_.jsx)(V,{configKey:"secondary",form:j,InfoLabelComponent:m})})]}),(0,_.jsxs)(s.Y,{justify:"flex-end",children:[(0,_.jsx)(t.$,{type:"submit",variant:"gradient",loading:f,leftSection:(0,_.jsx)(T.A,{size:16}),disabled:!e,children:"Save API Configuration"}),!e&&(0,_.jsxs)(r.j,{children:[(0,_.jsx)(r.j.Target,{children:(0,_.jsx)(l.M,{variant:"subtle",size:"xs",children:(0,_.jsx)(A.A,{size:16,color:"red"})})}),(0,_.jsx)(r.j.Dropdown,{maw:300,style:{zIndex:1e4},children:(0,_.jsxs)(d.E,{size:"sm",children:["ðŸ›‘ ",(0,_.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]})}function V({configKey:e,form:n,InfoLabelComponent:i}){const a=n.getValues().apiConfiguration[e].apis;return(0,_.jsxs)(_.Fragment,{children:["secondary"===e&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(s.Y,{gap:"xs",align:"center",mb:"sm",children:(0,_.jsx)(c.h,{order:4,children:(0,_.jsx)(i,{text:"Domains",scrollToId:"api-domains"})})}),(0,_.jsx)(u.k,{classNames:{label:Y.A["form-field-label"]},withAsterisk:!0,...n.getInputProps("apiConfiguration."+e+".domains"),mb:"md"},n.key("apiConfiguration."+e+".domains"))]}),(0,_.jsx)(s.Y,{gap:"xs",align:"center",mb:"sm",children:(0,_.jsx)(c.h,{order:4,children:"APIs"})}),(0,_.jsx)(F,{form:n,configKey:e,InfoLabelComponent:i}),(0,_.jsx)(s.Y,{gap:"xs",align:"center",mb:"sm",children:(0,_.jsx)(c.h,{order:4,children:(0,_.jsx)(i,{text:"Hooks",scrollToId:"api-hooks"})})}),(0,_.jsxs)(p.B,{gap:"md",children:[0===a.length&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(c.h,{order:5,ta:"center",mt:"lg",children:"No Hooks Configured"}),(0,_.jsx)(d.E,{c:"dimmed",size:"sm",ta:"center",mb:"lg",children:"You can configure hooks after adding at least one API."})]}),a.length>0&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(B,{title:"Sign In",form:n,configKey:e,hookKey:"signInHook",InfoLabelComponent:i}),(0,_.jsx)(B,{title:"Sign Out",form:n,configKey:e,hookKey:"signOutHook",InfoLabelComponent:i})]})]})]})}function B({title:e,form:n,configKey:i,hookKey:a,InfoLabelComponent:o}){const r=`apiConfiguration.${i}.${a}`,d=n.getValues().apiConfiguration[i].apis,x=!!n.getValues().apiConfiguration[i][a];return(0,_.jsx)(m.Z,{shadow:"sm",withBorder:!0,children:(0,_.jsxs)(p.B,{children:[(0,_.jsxs)(s.Y,{children:[(0,_.jsx)(c.h,{order:5,style:{flexGrow:1},children:e}),x&&(0,_.jsx)(g.m,{label:"Delete Hook",children:(0,_.jsx)(l.M,{color:"red",variant:"subtle","aria-label":"Delete Hook",onClick:()=>n.setFieldValue(r,void 0),children:(0,_.jsx)(w.A,{size:"1rem"})})}),!x&&(0,_.jsx)(t.$,{variant:"subtle",size:"compact-xs",leftSection:(0,_.jsx)(v.A,{size:16}),onClick:()=>n.setFieldValue(r,{apiName:"",path:"",options:{withCredentials:!1,headers:[],queryParams:[]}}),children:"Configure"})]}),x&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(s.Y,{grow:!0,children:[(0,_.jsx)(h.l,{classNames:{label:Y.A["form-field-label"]},label:(0,_.jsx)(o,{text:"API",scrollToId:"hook-api"}),withAsterisk:!0,data:d.map(e=>e.name),...n.getInputProps(`${r}.apiName`)},n.key(`${r}.apiName`)),(0,_.jsx)(u.k,{classNames:{label:Y.A["form-field-label"]},label:(0,_.jsx)(o,{text:"Path",scrollToId:"hook-path"}),withAsterisk:!0,...n.getInputProps(`${r}.path`)},n.key(`${r}.path`))]}),(0,_.jsx)(f.S,{label:(0,_.jsx)(o,{text:"With Credentials",scrollToId:"hook-credentials"}),style:{flexGrow:1},...n.getInputProps(`${r}.options.withCredentials`,{type:"checkbox"})},n.key(`${r}.options.withCredentials`)),(0,_.jsx)(c.h,{order:5,children:(0,_.jsx)(o,{text:"Headers",scrollToId:"hook-headers"})}),(0,_.jsx)(q,{form:n,configKey:i,hookKey:a,optionKey:"headers",addButtonLabel:"Add Header"}),(0,_.jsx)(c.h,{order:5,children:(0,_.jsx)(o,{text:"Query Params",scrollToId:"hook-headers"})}),(0,_.jsx)(q,{form:n,configKey:i,hookKey:a,optionKey:"queryParams",addButtonLabel:"Add Query Param"})]})]})})}function q({form:e,configKey:n,hookKey:i,optionKey:a,addButtonLabel:o}){const s=`apiConfiguration.${n}.${i}.options.${a}`,r=e.getValues(),d=r.apiConfiguration[n][i]?.options?.[a];return(0,_.jsxs)(x.a,{children:[(0,_.jsxs)(j.X,{withTableBorder:!0,children:[(0,_.jsx)(j.X.Thead,{children:(0,_.jsxs)(j.X.Tr,{children:[(0,_.jsx)(j.X.Th,{children:"Name"}),(0,_.jsx)(j.X.Th,{children:"Value"}),(0,_.jsx)(j.X.Th,{})]})}),(0,_.jsx)(j.X.Tbody,{children:d?.map((n,i)=>(0,_.jsxs)(j.X.Tr,{children:[(0,_.jsx)(j.X.Td,{children:(0,_.jsx)("input",{type:"text",...e.getInputProps(`${s}.${i}.name`),style:{border:"none",padding:0,margin:0,fontSize:"13px",width:"100%"}},e.key(`${s}.${i}.name`))}),(0,_.jsx)(j.X.Td,{children:(0,_.jsx)("input",{type:"text",...e.getInputProps(`${s}.${i}.value`),style:{border:"none",padding:0,margin:0,fontSize:"13px",width:"100%"}},e.key(`${s}.${i}.value`))}),(0,_.jsx)(j.X.Td,{children:(0,_.jsx)(l.M,{color:"red",variant:"subtle","aria-label":"Delete Header",onClick:()=>e.removeListItem(s,i),children:(0,_.jsx)(w.A,{size:"1rem"})})})]},n.key))})]}),(0,_.jsx)(t.$,{variant:"subtle",size:"compact-xs",leftSection:(0,_.jsx)($.A,{size:14}),w:"100%",mt:"0.3rem",onClick:()=>{e.insertListItem(s,{key:(0,b.z)(),name:"",value:""})},children:o})]})}function F({form:e,configKey:n,InfoLabelComponent:i}){const a=`apiConfiguration.${n}.apis`,o=e.getValues().apiConfiguration[n].apis,r=()=>{e.insertListItem(a,{key:(0,b.z)(),name:"",endpoint:"",region:"",authorization:"IAM"})};return o.length?(0,_.jsxs)(p.B,{gap:"md",mb:"lg",children:[o.map((a,o)=>(0,_.jsx)(G,{form:e,configKey:n,index:o,InfoLabelComponent:i},a.key)),(0,_.jsx)(s.Y,{justify:"center",children:(0,_.jsx)(t.$,{variant:"subtle",size:"compact-xs",leftSection:(0,_.jsx)($.A,{size:14}),w:"100%",mt:"0.3rem",onClick:r,children:"Add API"})})]}):(0,_.jsxs)(p.B,{align:"center",gap:"md",py:"xl",mb:"lg",children:[(0,_.jsx)(c.h,{order:4,children:"No APIs Configured"}),(0,_.jsx)(d.E,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any API definitions yet."}),(0,_.jsx)(t.$,{variant:"gradient",size:"xs",leftSection:(0,_.jsx)(H.A,{}),onClick:r,children:"Add API"})]})}function G({form:e,configKey:n,index:i,InfoLabelComponent:a}){const o=`apiConfiguration.${n}.apis.${i}`;return(0,_.jsx)(m.Z,{shadow:"sm",withBorder:!0,children:(0,_.jsxs)(p.B,{children:[(0,_.jsxs)(s.Y,{grow:!0,children:[(0,_.jsx)(u.k,{classNames:{label:Y.A["form-field-label"]},label:(0,_.jsx)(a,{text:"Name",scrollToId:"api-name"}),withAsterisk:!0,...e.getInputProps(`${o}.name`)},e.key(`${o}.name`)),(0,_.jsx)(h.l,{label:(0,_.jsx)(a,{text:"Authorization",scrollToId:"api-authorization"}),data:[{value:"IAM",label:"IAM"},{value:"ACCESS_TOKEN",label:"Access Token"},{value:"ID_TOKEN",label:"ID Token"}],defaultValue:"IAM",...e.getInputProps(`${o}.authorization`)},e.key(`${o}.authorization`))]}),(0,_.jsxs)(s.Y,{align:"center",children:[(0,_.jsx)(u.k,{classNames:{label:Y.A["form-field-label"]},label:(0,_.jsx)(a,{text:"Endpoint",scrollToId:"api-endpoint"}),withAsterisk:!0,...e.getInputProps(`${o}.endpoint`),style:{flexGrow:1}},e.key(`${o}.endpoint`)),(0,_.jsx)(g.m,{label:"Delete API",children:(0,_.jsx)(l.M,{color:"red",variant:"subtle","aria-label":"Delete API",mt:"lg",onClick:()=>e.removeListItem(`apiConfiguration.${n}.apis`,i),children:(0,_.jsx)(w.A,{size:"1rem"})})})]}),(0,_.jsx)(s.Y,{align:"center",children:(0,_.jsx)(u.k,{classNames:{label:Y.A["form-field-label"]},label:(0,_.jsx)(a,{text:"Region",scrollToId:"api-region"}),...e.getInputProps(`${o}.region`),style:{flexGrow:1}},e.key(`${o}.region`))})]})})}}}]);