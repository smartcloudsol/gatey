"use strict";(globalThis.webpackChunk_smart_cloud_gatey_admin=globalThis.webpackChunk_smart_cloud_gatey_admin||[]).push([[971],{57971:(e,n,o)=>{o.r(n),o.d(n,{default:()=>D});var i=o(94285),a=o(19689),t=o(64999),s=o(5055),r=o(48953),l=o(48324),d=o(17826),c=o(89652),u=o(69019),p=o(31179),m=o(4039),g=o(77828),h=o(57193),f=o(74533),x=o(14791),j=o(85091),y=o(69329),k=o(9543),I=o(45727),b=o(27723),C=o(26705),A=o(7641),z=o(84805),w=o(49568),v=o(20899),T=o(4225),$=o(36118),P=o(42449),H=(0,o(38728).A)("outline","row-insert-bottom","IconRowInsertBottom",[["path",{d:"M20 6v4a1 1 0 0 1 -1 1h-14a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h14a1 1 0 0 1 1 1z",key:"svg-0"}],["path",{d:"M12 15l0 4",key:"svg-1"}],["path",{d:"M14 17l-4 0",key:"svg-2"}]]),K=o(51609),S=o(69439),N=o(43226),O=o(70544),Y=o(10790);const _=S.Ik({key:S.Yj(),name:S.Yj().min(2),endpoint:S.Yj().min(2).url(),region:S.Yj().optional(),authorization:S.k5(["IAM","ACCESS_TOKEN","ID_TOKEN"])}),E=S.Ik({key:S.Yj(),name:S.Yj(),value:S.Yj()}),L=S.Ik({apiName:S.Yj(),path:S.Yj(),options:S.Ik({withCredentials:S.zM(),headers:S.YO(E).refine((e=>{const n=e.map((e=>e.name));return new Set(n).size===n.length}),{message:"Header names must be unique"}),queryParams:S.YO(E).refine((e=>{const n=e.map((e=>e.name));return new Set(n).size===n.length}),{message:"Query parameter names must be unique"})})}),M=S.Ik({apiConfiguration:S.Ik({default:S.Ik({apis:S.YO(_),signInHook:L.optional(),signOutHook:L.optional()}),secondary:S.Ik({apis:S.YO(_),signInHook:L.optional(),signOutHook:L.optional()})})});function D({amplifyConfigured:e,config:n,accountId:o,siteId:c,siteKey:u,onSave:p,InfoLabelComponent:m}){const[g,h]=(0,K.useState)(!1),[f,x]=(0,K.useState)(!1),j=(0,y.m)({mode:"uncontrolled",initialValues:{apiConfiguration:{default:{apis:[]},secondary:{apis:[]}}},validate:(T=M,e=>{const n=T.safeParse(e);if(n.success)return{};const o={};return"error"in n&&n.error.errors.forEach((e=>{o[e.path.join(".")]=e.message})),o})});var T;const $=(0,K.useCallback)((e=>e?Object.entries(e).map((([e,n])=>({key:(0,I.z)(),name:e,value:n}))):[]),[]),P=(0,K.useCallback)((e=>e?e.reduce(((e,n)=>(n.name&&(e[n.name]=n.value),e)),{}):{}),[]),H=(0,K.useCallback)((e=>{if(e)return{apiName:e.apiName,path:e.path,options:{withCredentials:e.options.withCredentials,headers:P(e.options.headers),queryParams:P(e.options.queryParams)}}}),[P]),S=(0,K.useCallback)((e=>{if(e)return{apiName:e.apiName,path:e.path,options:{withCredentials:e.options?.withCredentials||!1,headers:$(e.options?.headers),queryParams:$(e.options?.queryParams)}}}),[$]),_=(0,K.useCallback)((async e=>{if(o&&c&&u){x(!0);try{const a={...n,apiConfigurations:{default:{apis:e.apiConfiguration.default.apis.map((e=>({name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization}))),signInHook:H(e.apiConfiguration.default.signInHook),signOutHook:H(e.apiConfiguration.default.signOutHook)},secondary:e.apiConfiguration.secondary.apis?{apis:e.apiConfiguration.secondary.apis.map((e=>({name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization}))),signInHook:H(e.apiConfiguration.secondary.signInHook),signOutHook:H(e.apiConfiguration.secondary.signOutHook)}:void 0}};delete a.secondaryDomain,delete a.subscriptionType;const t=await async function(e,n,o,a){const t=(0,i.yJ)({apiName:"backend",path:`/account/${e}/site/${n}/settings`,options:{body:{settings:a},headers:{"X-Site-Key":o}}}),s=await t.response;if(s.statusCode<200||s.statusCode>=300)throw new Error(s.body.toString());return(await s.body.json()).settings}(o,c,u,a);p(t),k.$e.show({title:(0,b.__)("Settings saved",O.TEXT_DOMAIN),message:(0,b.__)("API settings saved successfully.",O.TEXT_DOMAIN),color:"green",icon:(0,Y.jsx)(C.A,{}),className:N.A.notification})}catch(e){console.error("Error saving API settings:",e),k.$e.show({title:(0,b.__)("Error occured",O.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,Y.jsx)(A.A,{}),className:N.A.notification})}finally{x(!1)}}else console.error("Missing account ID or site ID or site key")}),[o,n,p,c,u,H]);return(0,K.useEffect)((()=>{if(!g&&n){h(!0);const e={apiConfiguration:{default:{apis:(n.apiConfigurations?.default?.apis||[]).map((e=>({key:(0,I.z)(),name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization}))),signInHook:S(n.apiConfigurations?.default?.signInHook),signOutHook:S(n.apiConfigurations?.default?.signOutHook)},secondary:{apis:(n.apiConfigurations?.secondary?.apis||[]).map((e=>({key:(0,I.z)(),name:e.name,endpoint:e.endpoint,region:e.region,authorization:e.authorization}))),signInHook:S(n.apiConfigurations?.secondary?.signInHook),signOutHook:S(n.apiConfigurations?.secondary?.signOutHook)}}};j.setValues(e)}}),[n,j,S,g]),(0,K.useEffect)((()=>{n&&h(!1)}),[n]),(0,Y.jsxs)("form",{name:"apisettings-editor",onSubmit:j.onSubmit(_),children:[(0,Y.jsxs)(a.t,{defaultValue:"default",mb:"lg",children:[(0,Y.jsxs)(a.t.List,{children:[(0,Y.jsx)(a.t.Tab,{value:"default",leftSection:(0,Y.jsx)(z.A,{size:16}),children:(0,Y.jsx)(m,{text:"Default",scrollToId:"api-definitaions"})}),(0,Y.jsx)(a.t.Tab,{value:"secondary",leftSection:(0,Y.jsx)(w.A,{size:16}),children:(0,Y.jsx)(m,{text:"Secondary",scrollToId:"api-definitaions"})})]}),(0,Y.jsx)(a.t.Panel,{value:"default",p:"md",bg:"gray.1",children:(0,Y.jsx)(X,{configKey:"default",form:j,InfoLabelComponent:m})}),(0,Y.jsx)(a.t.Panel,{value:"secondary",p:"md",bg:"gray.1",children:(0,Y.jsx)(X,{configKey:"secondary",form:j,InfoLabelComponent:m})})]}),(0,Y.jsxs)(t.Y,{justify:"flex-end",children:[(0,Y.jsx)(s.$,{type:"submit",variant:"gradient",loading:f,leftSection:(0,Y.jsx)(v.A,{size:16}),disabled:!e,children:"Save API Configuration"}),!e&&(0,Y.jsxs)(r.j,{children:[(0,Y.jsx)(r.j.Target,{children:(0,Y.jsx)(l.M,{variant:"subtle",size:"xs",children:(0,Y.jsx)(A.A,{size:16,color:"red"})})}),(0,Y.jsx)(r.j.Dropdown,{maw:300,style:{zIndex:1e4},children:(0,Y.jsxs)(d.E,{size:"sm",children:["ðŸ›‘ ",(0,Y.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]})}function X({configKey:e,form:n,InfoLabelComponent:o}){const i=n.getValues().apiConfiguration[e].apis;return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(t.Y,{gap:"xs",align:"center",mb:"sm",children:(0,Y.jsx)(c.h,{order:4,children:"APIs"})}),(0,Y.jsx)(q,{form:n,configKey:e,InfoLabelComponent:o}),(0,Y.jsx)(t.Y,{gap:"xs",align:"center",mb:"sm",children:(0,Y.jsx)(c.h,{order:4,children:(0,Y.jsx)(o,{text:"Hooks",scrollToId:"api-hooks"})})}),(0,Y.jsxs)(u.B,{gap:"md",children:[0===i.length&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(c.h,{order:5,ta:"center",mt:"lg",children:"No Hooks Configured"}),(0,Y.jsx)(d.E,{c:"dimmed",size:"sm",ta:"center",mb:"lg",children:"You can configure hooks after adding at least one API."})]}),i.length>0&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(B,{title:"Sign In",form:n,configKey:e,hookKey:"signInHook",InfoLabelComponent:o}),(0,Y.jsx)(B,{title:"Sign Out",form:n,configKey:e,hookKey:"signOutHook",InfoLabelComponent:o})]})]})]})}function B({title:e,form:n,configKey:o,hookKey:i,InfoLabelComponent:a}){const r=`apiConfiguration.${o}.${i}`,d=n.getValues().apiConfiguration[o].apis,x=!!n.getValues().apiConfiguration[o][i];return(0,Y.jsx)(p.Z,{shadow:"sm",withBorder:!0,children:(0,Y.jsxs)(u.B,{children:[(0,Y.jsxs)(t.Y,{children:[(0,Y.jsx)(c.h,{order:5,style:{flexGrow:1},children:e}),x&&(0,Y.jsx)(m.m,{label:"Delete Hook",children:(0,Y.jsx)(l.M,{color:"red",variant:"subtle","aria-label":"Delete Hook",onClick:()=>n.setFieldValue(r,void 0),children:(0,Y.jsx)(T.A,{size:"1rem"})})}),!x&&(0,Y.jsx)(s.$,{variant:"subtle",size:"compact-xs",leftSection:(0,Y.jsx)($.A,{size:16}),onClick:()=>n.setFieldValue(r,{apiName:"",path:"",options:{withCredentials:!1,headers:[],queryParams:[]}}),children:"Configure"})]}),x&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(t.Y,{grow:!0,children:[(0,Y.jsx)(g.l,{classNames:{label:N.A["form-field-label"]},label:(0,Y.jsx)(a,{text:"API",scrollToId:"hook-api"}),withAsterisk:!0,data:d.map((e=>e.name)),...n.getInputProps(`${r}.apiName`)},n.key(`${r}.apiName`)),(0,Y.jsx)(h.k,{classNames:{label:N.A["form-field-label"]},label:(0,Y.jsx)(a,{text:"Path",scrollToId:"hook-path"}),withAsterisk:!0,...n.getInputProps(`${r}.path`)},n.key(`${r}.path`))]}),(0,Y.jsx)(f.S,{label:(0,Y.jsx)(a,{text:"With Credentials",scrollToId:"hook-credentials"}),style:{flexGrow:1},...n.getInputProps(`${r}.options.withCredentials`,{type:"checkbox"})},n.key(`${r}.options.withCredentials`)),(0,Y.jsx)(c.h,{order:5,children:(0,Y.jsx)(a,{text:"Headers",scrollToId:"hook-headers"})}),(0,Y.jsx)(V,{form:n,configKey:o,hookKey:i,optionKey:"headers",addButtonLabel:"Add Header"}),(0,Y.jsx)(c.h,{order:5,children:(0,Y.jsx)(a,{text:"Query Params",scrollToId:"hook-headers"})}),(0,Y.jsx)(V,{form:n,configKey:o,hookKey:i,optionKey:"queryParams",addButtonLabel:"Add Query Param"})]})]})})}function V({form:e,configKey:n,hookKey:o,optionKey:i,addButtonLabel:a}){const t=`apiConfiguration.${n}.${o}.options.${i}`,r=e.getValues(),d=r.apiConfiguration[n][o]?.options?.[i];return(0,Y.jsxs)(x.a,{children:[(0,Y.jsxs)(j.X,{withTableBorder:!0,children:[(0,Y.jsx)(j.X.Thead,{children:(0,Y.jsxs)(j.X.Tr,{children:[(0,Y.jsx)(j.X.Th,{children:"Name"}),(0,Y.jsx)(j.X.Th,{children:"Value"}),(0,Y.jsx)(j.X.Th,{})]})}),(0,Y.jsx)(j.X.Tbody,{children:d?.map(((n,o)=>(0,Y.jsxs)(j.X.Tr,{children:[(0,Y.jsx)(j.X.Td,{children:(0,Y.jsx)("input",{type:"text",...e.getInputProps(`${t}.${o}.name`),style:{border:"none",padding:0,margin:0,fontSize:"13px",width:"100%"}},e.key(`${t}.${o}.name`))}),(0,Y.jsx)(j.X.Td,{children:(0,Y.jsx)("input",{type:"text",...e.getInputProps(`${t}.${o}.value`),style:{border:"none",padding:0,margin:0,fontSize:"13px",width:"100%"}},e.key(`${t}.${o}.value`))}),(0,Y.jsx)(j.X.Td,{children:(0,Y.jsx)(l.M,{color:"red",variant:"subtle","aria-label":"Delete Header",onClick:()=>e.removeListItem(t,o),children:(0,Y.jsx)(T.A,{size:"1rem"})})})]},n.key)))})]}),(0,Y.jsx)(s.$,{variant:"subtle",size:"compact-xs",leftSection:(0,Y.jsx)(P.A,{size:14}),w:"100%",mt:"0.3rem",onClick:()=>{e.insertListItem(t,{key:(0,I.z)(),name:"",value:""})},children:a})]})}function q({form:e,configKey:n,InfoLabelComponent:o}){const i=`apiConfiguration.${n}.apis`,a=e.getValues().apiConfiguration[n].apis,r=()=>{e.insertListItem(i,{key:(0,I.z)(),name:"",endpoint:"",region:"",authorization:"IAM"})};return a.length?(0,Y.jsxs)(u.B,{gap:"md",mb:"lg",children:[a.map(((i,a)=>(0,Y.jsx)(F,{form:e,configKey:n,index:a,InfoLabelComponent:o},i.key))),(0,Y.jsx)(t.Y,{justify:"center",children:(0,Y.jsx)(s.$,{variant:"subtle",size:"compact-xs",leftSection:(0,Y.jsx)(P.A,{size:14}),w:"100%",mt:"0.3rem",onClick:r,children:"Add API"})})]}):(0,Y.jsxs)(u.B,{align:"center",gap:"md",py:"xl",mb:"lg",children:[(0,Y.jsx)(c.h,{order:4,children:"No APIs Configured"}),(0,Y.jsx)(d.E,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any API definitions yet."}),(0,Y.jsx)(s.$,{variant:"gradient",size:"xs",leftSection:(0,Y.jsx)(H,{}),onClick:r,children:"Add API"})]})}function F({form:e,configKey:n,index:o,InfoLabelComponent:i}){const a=`apiConfiguration.${n}.apis.${o}`;return(0,Y.jsx)(p.Z,{shadow:"sm",withBorder:!0,children:(0,Y.jsxs)(u.B,{children:[(0,Y.jsxs)(t.Y,{grow:!0,children:[(0,Y.jsx)(h.k,{classNames:{label:N.A["form-field-label"]},label:(0,Y.jsx)(i,{text:"Name",scrollToId:"api-name"}),withAsterisk:!0,...e.getInputProps(`${a}.name`)},e.key(`${a}.name`)),(0,Y.jsx)(g.l,{label:(0,Y.jsx)(i,{text:"Authorization",scrollToId:"api-authorization"}),data:[{value:"IAM",label:"IAM"},{value:"ACCESS_TOKEN",label:"Access Token"},{value:"ID_TOKEN",label:"ID Token"}],defaultValue:"IAM",...e.getInputProps(`${a}.authorization`)},e.key(`${a}.authorization`))]}),(0,Y.jsxs)(t.Y,{align:"center",children:[(0,Y.jsx)(h.k,{classNames:{label:N.A["form-field-label"]},label:(0,Y.jsx)(i,{text:"Endpoint",scrollToId:"api-endpoint"}),withAsterisk:!0,...e.getInputProps(`${a}.endpoint`),style:{flexGrow:1}},e.key(`${a}.endpoint`)),(0,Y.jsx)(m.m,{label:"Delete API",children:(0,Y.jsx)(l.M,{color:"red",variant:"subtle","aria-label":"Delete API",mt:"lg",onClick:()=>e.removeListItem(`apiConfiguration.${n}.apis`,o),children:(0,Y.jsx)(T.A,{size:"1rem"})})})]}),(0,Y.jsx)(t.Y,{align:"center",children:(0,Y.jsx)(h.k,{classNames:{label:N.A["form-field-label"]},label:(0,Y.jsx)(i,{text:"Region",scrollToId:"api-region"}),...e.getInputProps(`${a}.region`),style:{flexGrow:1}},e.key(`${a}.region`))})]})})}}}]);